(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1584:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>n.a,__next_app__:()=>d,originalPathname:()=>c,pages:()=>h,routeModule:()=>p,tree:()=>u}),i(908),i(1506),i(5866);var r=i(3191),a=i(8716),s=i(7922),n=i.n(s),o=i(5231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);i.d(t,l);let u=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,908)),"/Users/mukil/langchain/langsmith-sdk/js/internal/environment_tests/test-exports-nextjs/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(i.bind(i,1506)),"/Users/mukil/langchain/langsmith-sdk/js/internal/environment_tests/test-exports-nextjs/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,5866,23)),"next/dist/client/components/not-found-error"]}],h=["/Users/mukil/langchain/langsmith-sdk/js/internal/environment_tests/test-exports-nextjs/app/page.tsx"],c="/page",d={require:i,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},6466:(e,t,i)=>{Promise.resolve().then(i.bind(i,9959))},1222:(e,t,i)=>{Promise.resolve().then(i.t.bind(i,2994,23)),Promise.resolve().then(i.t.bind(i,6114,23)),Promise.resolve().then(i.t.bind(i,9727,23)),Promise.resolve().then(i.t.bind(i,9671,23)),Promise.resolve().then(i.t.bind(i,1868,23)),Promise.resolve().then(i.t.bind(i,4759,23))},5303:()=>{},9959:(e,t,i)=>{"use strict";let r,a,s;i.r(t),i.d(t,{default:()=>e9});var n=i(326);let o=require("node:crypto");var l=i.n(o);let u={randomUUID:l().randomUUID},h=new Uint8Array(256),c=h.length;function d(){return c>h.length-16&&(l().randomFillSync(h),c=0),h.slice(c,c+=16)}let p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));function m(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}let f=function(e,t,i){if(u.randomUUID&&!t&&!e)return u.randomUUID();let r=(e=e||{}).random||(e.rng||d)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=r[e];return t}return m(r)},_="gen_ai.request.model",g="gen_ai.usage.input_tokens",y="gen_ai.usage.output_tokens",b="gen_ai.usage.total_tokens",w="langsmith.span.tags",v=()=>"undefined"!=typeof window&&void 0!==window.document,E=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,S=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),I=()=>"undefined"!=typeof Deno,O=()=>"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node&&!I(),$=()=>(r||("undefined"!=typeof Bun?r="bun":r=v()?"browser":O()?"node":E()?"webworker":S()?"jsdom":I()?"deno":"other"),r);function T(){return void 0===a&&(a={library:"langsmith",runtime:$(),sdk:"langsmith-js",sdk_version:e6,...function(){if(void 0!==s)return s;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let i=A(t);void 0!==i&&(e[t]=i)}return s=e,e}()}),a}function P(){let e=function(){let e={};try{if("undefined"!=typeof process&&process.env)for(let[t,i]of Object.entries(process.env))(t.startsWith("LANGCHAIN_")||t.startsWith("LANGSMITH_"))&&null!=i&&((t.toLowerCase().includes("key")||t.toLowerCase().includes("secret")||t.toLowerCase().includes("token"))&&"string"==typeof i?e[t]=i.slice(0,2)+"*".repeat(i.length-4)+i.slice(-2):e[t]=i)}catch(e){}return e}(),t={},i=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[r,a]of Object.entries(e))"string"!=typeof a||i.includes(r)||r.toLowerCase().includes("key")||r.toLowerCase().includes("secret")||r.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===r?t.revision_id=a:t[r]=a);return t}function A(e){try{return"undefined"!=typeof process?process.env?.[e]:void 0}catch(e){return}}function R(e){return A(`LANGSMITH_${e}`)||A(`LANGCHAIN_${e}`)}function x(){return"true"===A("OTEL_ENABLED")||"true"===R("OTEL_ENABLED")}class N{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...t){let i;if(!this.hasWarned&&x()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0),1===t.length&&"function"==typeof t[0]?i=t[0]:2===t.length&&"function"==typeof t[1]?i=t[1]:3===t.length&&"function"==typeof t[2]&&(i=t[2]),"function"==typeof i)return i()}}class j{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new N})}getTracer(e,t){return this.mockTracer}getActiveSpan(){}setSpan(e,t){return e}getSpan(e){}setSpanContext(e,t){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class C{active(){return{}}with(e,t){return t()}}let L=Symbol.for("ls:otel_trace"),U=Symbol.for("ls:otel_context"),k=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),D=new j,M=new C;class F{getTraceInstance(){return globalThis[L]??D}getContextInstance(){return globalThis[U]??M}initializeGlobalInstances(e){void 0===globalThis[L]&&(globalThis[L]=e.trace),void 0===globalThis[U]&&(globalThis[U]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[k]=e}getDefaultOTLPTracerComponents(){return globalThis[k]??void 0}}let z=new F;function B(){return z.getTraceInstance()}let G={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};class q{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,t){for(let i of e)try{if(!i.run)continue;if("post"===i.operation){let e=this.createSpanForRun(i,i.run,t.get(i.id));e&&!i.run.end_time&&this.spans.set(i.id,e)}else this.updateSpanForRun(i,i.run)}catch(e){console.error(`Error processing operation ${i.id}:`,e)}}createSpanForRun(e,t,i){let r=i&&B().getSpan(i);if(r)try{return this.finishSpanSetup(r,t,e)}catch(t){console.error(`Failed to create span for run ${e.id}:`,t);return}}finishSpanSetup(e,t,i){return this.setSpanAttributes(e,t,i),t.error?(e.setStatus({code:2}),e.recordException(Error(t.error))):e.setStatus({code:1}),t.end_time&&e.end(new Date(t.end_time)),e}updateSpanForRun(e,t){try{let i=this.spans.get(e.id);if(!i){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(i,t,e),t.error?(i.setStatus({code:2}),i.recordException(Error(t.error))):i.setStatus({code:1});let r=t.end_time;r&&(i.end(new Date(r)),this.spans.delete(e.id))}catch(t){console.error(`Failed to update span for run ${e.id}:`,t)}}extractModelName(e){if(e.extra?.metadata){let t=e.extra.metadata;if(t.ls_model_name)return t.ls_model_name;if(t.invocation_params){let e=t.invocation_params;if(e.model)return e.model;if(e.model_name)return e.model_name}}}setSpanAttributes(e,t,i){if("run_type"in t&&t.run_type){var r;e.setAttribute("langsmith.span.kind",t.run_type);let i=G[r=t.run_type||"chain"]||r;e.setAttribute("gen_ai.operation.name",i)}"name"in t&&t.name&&e.setAttribute("langsmith.trace.name",t.name),"session_id"in t&&t.session_id&&e.setAttribute("langsmith.trace.session_id",t.session_id),"session_name"in t&&t.session_name&&e.setAttribute("langsmith.trace.session_name",t.session_name),this.setGenAiSystem(e,t);let a=this.extractModelName(t);for(let[i,r]of(a&&e.setAttribute(_,a),"prompt_tokens"in t&&"number"==typeof t.prompt_tokens&&e.setAttribute(g,t.prompt_tokens),"completion_tokens"in t&&"number"==typeof t.completion_tokens&&e.setAttribute(y,t.completion_tokens),"total_tokens"in t&&"number"==typeof t.total_tokens&&e.setAttribute(b,t.total_tokens),this.setInvocationParameters(e,t),Object.entries(t.extra?.metadata||{})))null!=r&&e.setAttribute(`langsmith.metadata.${i}`,String(r));let s=t.tags;if(s&&Array.isArray(s)?e.setAttribute(w,s.join(", ")):s&&e.setAttribute(w,String(s)),"serialized"in t&&"object"==typeof t.serialized){let i=t.serialized;i.name&&e.setAttribute("gen_ai.serialized.name",String(i.name)),i.signature&&e.setAttribute("gen_ai.serialized.signature",String(i.signature)),i.doc&&e.setAttribute("gen_ai.serialized.doc",String(i.doc))}this.setIOAttributes(e,i)}setGenAiSystem(e,t){let i="langchain",r=this.extractModelName(t);if(r){let e=r.toLowerCase();e.includes("anthropic")||e.startsWith("claude")?i="anthropic":e.includes("bedrock")?i="aws.bedrock":e.includes("azure")&&e.includes("openai")?i="az.ai.openai":e.includes("azure")&&e.includes("inference")?i="az.ai.inference":e.includes("cohere")?i="cohere":e.includes("deepseek")?i="deepseek":e.includes("gemini")?i="gemini":e.includes("groq")?i="groq":e.includes("watson")||e.includes("ibm")?i="ibm.watsonx.ai":e.includes("mistral")?i="mistral_ai":e.includes("gpt")||e.includes("openai")?i="openai":e.includes("perplexity")||e.includes("sonar")?i="perplexity":e.includes("vertex")?i="vertex_ai":(e.includes("xai")||e.includes("grok"))&&(i="xai")}e.setAttribute("gen_ai.system",i)}setInvocationParameters(e,t){if(!t.extra?.metadata?.invocation_params)return;let i=t.extra.metadata.invocation_params;void 0!==i.max_tokens&&e.setAttribute("gen_ai.request.max_tokens",i.max_tokens),void 0!==i.temperature&&e.setAttribute("gen_ai.request.temperature",i.temperature),void 0!==i.top_p&&e.setAttribute("gen_ai.request.top_p",i.top_p),void 0!==i.frequency_penalty&&e.setAttribute("gen_ai.request.frequency_penalty",i.frequency_penalty),void 0!==i.presence_penalty&&e.setAttribute("gen_ai.request.presence_penalty",i.presence_penalty)}setIOAttributes(e,t){if(t.run.inputs)try{let i=t.run.inputs;"object"==typeof i&&null!==i&&(i.model&&Array.isArray(i.messages)&&e.setAttribute(_,i.model),void 0!==i.stream&&e.setAttribute("langsmith.request.streaming",i.stream),i.extra_headers&&e.setAttribute("langsmith.request.headers",JSON.stringify(i.extra_headers)),i.extra_query&&e.setAttribute("gen_ai.request.extra_query",JSON.stringify(i.extra_query)),i.extra_body&&e.setAttribute("gen_ai.request.extra_body",JSON.stringify(i.extra_body))),e.setAttribute("gen_ai.prompt",JSON.stringify(i))}catch(e){console.debug(`Failed to process inputs for run ${t.id}`,e)}if(t.run.outputs)try{let i=t.run.outputs,r=this.getUnifiedRunTokens(i);if(r&&(e.setAttribute(g,r[0]),e.setAttribute(y,r[1]),e.setAttribute(b,r[0]+r[1])),i&&"object"==typeof i){if(i.model&&e.setAttribute("gen_ai.response.model",String(i.model)),i.id&&e.setAttribute("gen_ai.response.id",i.id),i.choices&&Array.isArray(i.choices)){let t=i.choices.map(e=>e.finish_reason).filter(e=>e).map(String);t.length>0&&e.setAttribute("gen_ai.response.finish_reasons",t.join(", "))}if(i.service_tier&&e.setAttribute("gen_ai.response.service_tier",i.service_tier),i.system_fingerprint&&e.setAttribute("gen_ai.response.system_fingerprint",i.system_fingerprint),i.usage_metadata&&"object"==typeof i.usage_metadata){let t=i.usage_metadata;t.input_token_details&&e.setAttribute("gen_ai.usage.input_token_details",JSON.stringify(t.input_token_details)),t.output_token_details&&e.setAttribute("gen_ai.usage.output_token_details",JSON.stringify(t.output_token_details))}}e.setAttribute("gen_ai.completion",JSON.stringify(i))}catch(e){console.debug(`Failed to process outputs for run ${t.id}`,e)}}getUnifiedRunTokens(e){if(!e)return null;let t=this.extractUnifiedRunTokens(e.usage_metadata);if(t)return t;for(let i of Object.keys(e)){let r=e[i];if(r&&"object"==typeof r&&((t=this.extractUnifiedRunTokens(r.usage_metadata))||1===r.lc&&r.kwargs&&"object"==typeof r.kwargs&&(t=this.extractUnifiedRunTokens(r.kwargs.usage_metadata))))return t}let i=e.generations||[];if(!Array.isArray(i))return null;for(let e of Array.isArray(i[0])?i.flat():i)if("object"==typeof e&&e.message&&"object"==typeof e.message&&e.message.kwargs&&"object"==typeof e.message.kwargs&&(t=this.extractUnifiedRunTokens(e.message.kwargs.usage_metadata)))return t;return null}extractUnifiedRunTokens(e){return e&&"object"==typeof e&&"number"==typeof e.input_tokens&&"number"==typeof e.output_tokens?[e.input_tokens,e.output_tokens]:null}}let H=Object.prototype.toString,J=e=>"[object Error]"===H.call(e),K=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function W(e,t,{min:i=0,allowInfinity:r=!1}={}){if(void 0!==t){if("number"!=typeof t||Number.isNaN(t))throw TypeError(`Expected \`${e}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(t))throw TypeError(`Expected \`${e}\` to be a finite number.`);if(t<i)throw TypeError(`Expected \`${e}\` to be \u2265 ${i}.`)}}class V extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}function X(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function Q({error:e,attemptNumber:t,retriesConsumed:i,startTime:r,options:a}){let s=e instanceof Error?e:TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(s instanceof V)throw s.originalError;let n=Number.isFinite(a.retries)?Math.max(0,a.retries-i):a.retries,o=a.maxRetryTime??Number.POSITIVE_INFINITY,l=Object.freeze({error:s,attemptNumber:t,retriesLeft:n,retriesConsumed:i});if(await a.onFailedAttempt(l),0>=X(r,o))throw s;let u=await a.shouldConsumeRetry(l),h=X(r,o);if(h<=0||n<=0)throw s;if(s instanceof TypeError&&!function(e){if(!(e&&J(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:i}=e;return"Load failed"===t?void 0===i||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||K.has(t)}(s)){if(u)throw s;return a.signal?.throwIfAborted(),!1}if(!await a.shouldRetry(l))throw s;if(!u)return a.signal?.throwIfAborted(),!1;let c=Math.min(Math.min(Math.round((a.randomize?Math.random()+1:1)*a.minTimeout*a.factor**(Math.max(1,i+1)-1)),a.maxTimeout),h);return c>0&&await new Promise((e,t)=>{let i=()=>{clearTimeout(r),a.signal?.removeEventListener("abort",i),t(a.signal.reason)},r=setTimeout(()=>{a.signal?.removeEventListener("abort",i),e()},c);a.unref&&r.unref?.(),a.signal?.addEventListener("abort",i,{once:!0})}),a.signal?.throwIfAborted(),!0}async function Y(e,t={}){if(function(e){if("number"==typeof e){if(e<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(e))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==e)throw TypeError("Expected `retries` to be a number or Infinity.")}((t={...t}).retries),Object.hasOwn(t,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=Number.POSITIVE_INFINITY,t.maxRetryTime??=Number.POSITIVE_INFINITY,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,W("factor",t.factor,{min:0,allowInfinity:!1}),W("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),W("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),W("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let i=0,r=0,a=performance.now();for(;!Number.isFinite(t.retries)||r<=t.retries;){i++;try{t.signal?.throwIfAborted();let r=await e(i);return t.signal?.throwIfAborted(),r}catch(e){await Q({error:e,attemptNumber:i,retriesConsumed:r,startTime:a,options:t})&&r++}}throw Error("Retry attempts exhausted without throwing an error.")}var Z=i(9239);let ee=[408,425,429,500,502,503,504];class et{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,this.queue=new Z.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){return this.callWithOptions({},e,...t)}callWithOptions(e,t,...i){let r=e.sizeBytes??0;if(void 0!==this.maxQueueSizeBytes&&r>0&&this.queueSizeBytes+r>this.maxQueueSizeBytes)return Promise.reject(Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${r} bytes.`));r>0&&(this.queueSizeBytes+=r);let a=this.onFailedResponseHook,s=this.queue.add(()=>Y(()=>t(...i).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt({error:e}){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||"TimeoutError"===e.name||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response;if(a&&await a(t))return;let i=t?.status??e?.status;if(i&&!ee.includes(+i))throw e},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return(r>0&&(s=s.finally(()=>{this.queueSizeBytes-=r})),e.signal)?Promise.race([s,new Promise((t,i)=>{e.signal?.addEventListener("abort",()=>{i(Error("AbortError"))})})]):s}}function ei(e){return"function"==typeof e?._getType}function er(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}let ea=null,es=null,en=0,eo=function(e,t,i){e=e||{};let r=t&&i||0,a=t||new Uint8Array(16),s=e.random||(e.rng||d)(),n=void 0!==e.msecs?e.msecs:Date.now(),o=void 0!==e.seq?e.seq:null,l=es,u=ea;return n>en&&void 0===e.msecs&&(en=n,null!==o&&(l=null,u=null)),null!==o&&(o>2147483647&&(o=2147483647),l=o>>>19&4095,u=524287&o),(null===l||null===u)&&(l=(l=127&s[6])<<8|s[7],u=(u=(u=63&s[8])<<8|s[9])<<5|s[10]>>>3),n+1e4>en&&null===o?++u>524287&&(u=0,++l>4095&&(l=0,en++)):en=n,es=l,ea=u,a[r++]=en/1099511627776&255,a[r++]=en/4294967296&255,a[r++]=en/16777216&255,a[r++]=en/65536&255,a[r++]=en/256&255,a[r++]=255&en,a[r++]=l>>>4&15|112,a[r++]=255&l,a[r++]=u>>>13&63|128,a[r++]=u>>>5&255,a[r++]=u<<3&255|7&s[10],a[r++]=s[11],a[r++]=s[12],a[r++]=s[13],a[r++]=s[14],a[r++]=s[15],t||m(a)},el={};function eu(e){el[e]||(console.warn(e),el[e]=!0)}let eh=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function ec(e,t){if(!eh.test(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}function ed(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,i]=e.split(":"),r=i||"latest";if(t.includes("/")){let[i,a]=t.split("/",2);if(!i||!a)throw Error(`Invalid identifier format: ${e}`);return[i,a,r]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,r]}i(1998);class ep extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}class em extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithNotFoundError",this.status=404}}function ef(e){return null!=e&&"object"==typeof e&&"name"in e&&e?.name==="LangSmithNotFoundError"}async function e_(e,t,i){let r;if(e.ok){i&&(r=await e.text());return}if(403===e.status)try{let t=await e.json(),i=t?.error;"org_scoped_key_requires_workspace"===i&&(r="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch(i){let t=Error(`${e.status} ${e.statusText}`);throw t.status=e?.status,t}if(void 0===r)try{r=await e.text()}catch(e){r=""}let a=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Message: ${r}`;if(404===e.status)throw new em(a);if(409===e.status)throw new ep(a);let s=Error(a);throw s.status=e.status,s}let eg="ERR_CONFLICTING_ENDPOINTS";class ey extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:eg}),this.name="ConflictingEndpointsError"}}let eb=require("node:fs"),ew=require("node:path");class ev{constructor(e={}){Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ttlSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshIntervalSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_metrics",{enumerable:!0,configurable:!0,writable:!0,value:{hits:0,misses:0,refreshes:0,refreshErrors:0}}),this.maxSize=e.maxSize??100,this.ttlSeconds=e.ttlSeconds??3600,this.refreshIntervalSeconds=e.refreshIntervalSeconds??60,this.fetchFunc=e.fetchFunc,this.fetchFunc&&null!==this.ttlSeconds&&this.startRefreshLoop()}get metrics(){return{...this._metrics}}get totalRequests(){return this._metrics.hits+this._metrics.misses}get hitRate(){let e=this.totalRequests;return e>0?this._metrics.hits/e:0}resetMetrics(){this._metrics={hits:0,misses:0,refreshes:0,refreshErrors:0}}get(e){let t=this.cache.get(e);if(!t){this._metrics.misses+=1;return}return this.cache.delete(e),this.cache.set(e,t),this._metrics.hits+=1,t.value}set(e,t){if(!this.cache.has(e)&&this.cache.size>=this.maxSize){let e=this.cache.keys().next().value;void 0!==e&&this.cache.delete(e)}let i={value:t,createdAt:Date.now()};this.cache.delete(e),this.cache.set(e,i)}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}stop(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=void 0)}dump(e){let t={};for(let[e,i]of this.cache.entries())t[e]=i.value;!function(e,t){let i=ew.dirname(e);eb.existsSync(i)||eb.mkdirSync(i,{recursive:!0});let r=`${e}.tmp`;try{eb.writeFileSync(r,JSON.stringify({entries:t},null,2)),eb.renameSync(r,e)}catch(e){throw eb.existsSync(r)&&eb.unlinkSync(r),e}}(e,t)}load(e){let t=function(e){if(!eb.existsSync(e))return null;try{let t=eb.readFileSync(e,"utf-8");return JSON.parse(t).entries??null}catch{return null}}(e);if(!t)return 0;let i=0,r=Date.now();for(let[e,a]of Object.entries(t)){if(this.cache.size>=this.maxSize)break;let t={value:a,createdAt:r};this.cache.set(e,t),i+=1}return i}startRefreshLoop(){this.refreshTimer=setInterval(()=>{this.refreshStaleEntries().catch(e=>{console.warn("Unexpected error in cache refresh loop:",e)})},1e3*this.refreshIntervalSeconds),this.refreshTimer.unref&&this.refreshTimer.unref()}getStaleKeys(){let e=[];for(let[i,r]of this.cache.entries()){var t;null!==(t=this.ttlSeconds)&&Date.now()-r.createdAt>1e3*t&&e.push(i)}return e}async refreshStaleEntries(){if(!this.fetchFunc)return;let e=this.getStaleKeys();if(0!==e.length)for(let t of e)try{let e=await this.fetchFunc(t);this.set(t,e),this._metrics.refreshes+=1}catch(e){this._metrics.refreshErrors+=1,console.warn(`Failed to refresh cache entry ${t}:`,e)}}}let eE=(...e)=>fetch(...e),eS=Symbol.for("ls:fetch_implementation"),eI=()=>{let e=globalThis[eS];return!!e&&"function"==typeof e&&"Headers"in e&&"Request"in e&&"Response"in e},eO=e=>async(...t)=>{if(e||"true"===R("DEBUG")){let[e,i]=t;console.log(`→ ${i?.method||"GET"} ${e}`)}let i=await (globalThis[eS]??eE)(...t);return(e||"true"===R("DEBUG"))&&console.log(`← ${i.status} ${i.statusText} ${i.url}`),i};var e$={result:"[Circular]"},eT=[],eP=[];let eA=new TextEncoder;function eR(e){return eA.encode(e)}function ex(e){if(e&&"object"==typeof e&&null!==e){if(e instanceof Map)return Object.fromEntries(e);if(e instanceof Set)return Array.from(e);if(e instanceof Date)return e.toISOString();if(e instanceof RegExp)return e.toString();else if(e instanceof Error)return{name:e.name,message:e.message}}else if("bigint"==typeof e)return e.toString();return e}function eN(e,t,i,r,a){try{let t=JSON.stringify(e,function(e,t){if(i){let r=i.call(this,e,t);if(void 0!==r)return r}return ex(t)},r);return eR(t)}catch(o){let n;if(!o.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),eR("[Unserializable]");"true"!==R("SUPPRESS_CIRCULAR_JSON_WARNINGS")&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===a&&(a={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,i,r,a,s,n,o){if(n+=1,"object"==typeof t&&null!==t){for(l=0;l<a.length;l++)if(a[l]===t){ej(e$,t,i,s);return}if(void 0!==o.depthLimit&&n>o.depthLimit||void 0!==o.edgesLimit&&r+1>o.edgesLimit){ej("[...]",t,i,s);return}if(a.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,a,t,n,o);else{var l,u=Object.keys(t=ex(t));for(l=0;l<u.length;l++){var h=u[l];e(t[h],h,l,a,t,n,o)}}a.pop()}}(e,"",0,[],void 0,0,a);try{var s;n=0===eP.length?JSON.stringify(e,i,r):JSON.stringify(e,(s=i,s=void 0!==s?s:function(e,t){return t},function(e,t){if(eP.length>0)for(var i=0;i<eP.length;i++){var r=eP[i];if(r[1]===e&&r[0]===t){t=r[2],eP.splice(i,1);break}}return s.call(this,e,t)}),r)}catch(e){return eR("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==eT.length;){let e=eT.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return eR(n)}}function ej(e,t,i,r){var a=Object.getOwnPropertyDescriptor(r,i);void 0!==a.get?a.configurable?(Object.defineProperty(r,i,{value:e}),eT.push([r,i,t,a])):eP.push([t,i,e]):(r[i]=e,eT.push([r,i,t]))}function eC(e,t,i){if(i)return e;let r=T(),a=t??P(),s=e.extra??{},n=s.metadata;return e.extra={...s,runtime:{...r,...s?.runtime},metadata:{...a,...a.revision_id||"revision_id"in e&&e.revision_id?{revision_id:("revision_id"in e?e.revision_id:void 0)??a.revision_id}:{},...n}},e}let eL=e=>{let t=e?.toString()??R("TRACING_SAMPLING_RATE");if(void 0===t)return;let i=parseFloat(t);if(i<0||i>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${i}`);return i},eU=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t};async function ek(e){let t=[];for await(let i of e)t.push(i);return t}function eD(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let eM=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"10",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function eF(e){return"number"==typeof e?Number(e.toFixed(4)):e}let ez="https://api.smith.langchain.com";class eB{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??1073741824}peek(){return this.items[0]}push(e){let t;let i=new Promise(e=>{t=e}),r=eN(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+r>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${r} bytes.`),t()):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:t,itemPromise:i,size:r}),this.sizeBytes+=r),i}pop({upToSizeBytes:e,upToSize:t}){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let i=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0&&i.length<t;){let e=this.items.shift();e&&(i.push(e),r+=e.size,this.sizeBytes-=e.size)}if(0===i.length&&this.items.length>0){let e=this.items.shift();i.push(e),r+=e.size,this.sizeBytes-=e.size}return[i.map(e=>({action:e.action,item:e.payload,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,size:e.size})),()=>i.forEach(e=>e.itemPromiseResolve())]}}class eG{get _fetch(){return this.fetchImplementation||eO(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitTracedRuntimeInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===A("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_promptCache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_multipartDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===A("LANGSMITH_DEBUG")});let t=eG.getDefaultClientConfig();if(this.tracingSampleRate=eL(e.tracingSamplingRate),this.apiUrl=eD(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=eD(e.apiKey??t.apiKey),this.webUrl=eD(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=eD(e.workspaceId??R("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new et({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;let i=e.maxIngestMemoryBytes??1073741824;if(this.batchIngestCaller=new et({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:i,...e.callerOptions??{},onFailedResponseHook:eM,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.omitTracedRuntimeInfo=e.omitTracedRuntimeInfo??!1,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new eB(i),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,x()&&(this.langSmithToOTELTranslator=new q),this.cachedLSEnvVarsForMetadata=P(),e.promptCacheEnabled??"true"===R("PROMPT_CACHE_ENABLED")){this._promptCache=new ev({maxSize:e.promptCacheMaxSize??parseInt(R("PROMPT_CACHE_MAX_SIZE")??"100",10),ttlSeconds:e.promptCacheTtlSeconds??parseFloat(R("PROMPT_CACHE_TTL_SECONDS")??"3600"),refreshIntervalSeconds:e.promptCacheRefreshIntervalSeconds??parseFloat(R("PROMPT_CACHE_REFRESH_INTERVAL_SECONDS")??"60"),fetchFunc:this._makeFetchPromptFunc()});let t=e.promptCachePath??R("PROMPT_CACHE_PATH");if(t)try{this._promptCache.load(t)}catch(e){console.warn(`Failed to load prompt cache from ${t}:`,e)}}}static getDefaultClientConfig(){let e=R("API_KEY");return{apiUrl:R("ENDPOINT")??ez,apiKey:e,webUrl:void 0,hideInputs:"true"===R("HIDE_INPUTS"),hideOutputs:"true"===R("HIDE_OUTPUTS")}}getHostUrl(){if(this.webUrl)return this.webUrl;if(eU(this.apiUrl))return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${e6}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return"/v1"!==this.apiUrl.slice(-3)&&"/v1/"!==this.apiUrl.slice(-4)?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let i=t?.toString()??"",r=`${this.apiUrl}${e}?${i}`;return await this.caller.call(async()=>{let t=await this._fetch(r,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,`fetch ${e}`),t})}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,i){let r=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));let s=`${this.apiUrl}${e}?${t}`,n=await this.caller.call(async()=>{let t=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,`fetch ${e}`),t}),o=i?i(await n.json()):await n.json();if(0===o.length||(yield o,o.length<a))break;r+=o.length}}async *_getCursorPaginatedList(e,t=null,i="POST",r="runs"){let a=t?{...t}:{};for(;;){let t=JSON.stringify(a),s=await this.caller.call(async()=>{let r=await this._fetch(`${this.apiUrl}${e}`,{method:i,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:t});return await e_(r,`fetch ${e}`),r}),n=await s.json();if(!n||!n[r])break;yield n[r];let o=n.cursors;if(!o||!o.next)break;a.cursor=o.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let i of e)this.filteredPostUuids.has(i.trace_id)?i.id===i.trace_id&&this.filteredPostUuids.delete(i.trace_id):t.push(i);return t}{let t=[];for(let i of e){let e=i.trace_id??i.id;this.filteredPostUuids.has(e)||(i.id===e?this._shouldSample()?t.push(i):this.filteredPostUuids.add(e):t.push(i))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e?.batch_ingest_config?.size_limit_bytes??25165824}async _getBatchSizeLimit(){let e=await this._ensureServerInfo();return this.batchSizeLimit??e?.batch_ingest_config?.size_limit??100}async _getDatasetExamplesMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t}){let i=[];for(;this.autoBatchQueue.items.length>0;){let[r,a]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:t});if(!r.length){a();break}let s=r.reduce((e,t)=>{let i=t.apiUrl??this.apiUrl,r=t.apiKey??this.apiKey,a=t.apiKey===this.apiKey&&t.apiUrl===this.apiUrl?"default":`${i}|${r}`;return e[a]||(e[a]=[]),e[a].push(t),e},{}),n=[];for(let[e,t]of Object.entries(s)){let i=this._processBatch(t,{apiUrl:"default"===e?void 0:e.split("|")[0],apiKey:"default"===e?void 0:e.split("|")[1]});n.push(i)}let o=Promise.all(n).finally(a);i.push(o)}return Promise.all(i)}async _processBatch(e,t){if(!e.length)return;let i=e.reduce((e,t)=>e+(t.size??0),0);try{if(void 0!==this.langSmithToOTELTranslator)this._sendBatchToOTELTranslator(e);else{let r={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},a=await this._ensureServerInfo();if(!this._multipartDisabled&&(a?.batch_ingest_config?.use_multipart_endpoint??!0)){let e=a?.instance_flags?.gzip_body_enabled;try{await this.multipartIngestRuns(r,{...t,useGzip:e,sizeBytes:i})}catch(e){if(ef(e))this._multipartDisabled=!0,await this.batchIngestRuns(r,{...t,sizeBytes:i});else throw e}}else await this.batchIngestRuns(r,{...t,sizeBytes:i})}}catch(e){console.error("Error exporting batch:",e)}}_sendBatchToOTELTranslator(e){if(void 0!==this.langSmithToOTELTranslator){let t=new Map,i=[];for(let r of e)r.item.id&&r.otelContext&&(t.set(r.item.id,r.otelContext),"create"===r.action?i.push({operation:"post",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}):i.push({operation:"patch",id:r.item.id,trace_id:r.item.trace_id??r.item.id,run:r.item}));this.langSmithToOTELTranslator.exportBatch(i,t)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=eC(e.item,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let i=await this._getBatchSizeLimitBytes(),r=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>i||this.autoBatchQueue.items.length>r)&&this.drainAutoBatchQueue({batchSizeLimitBytes:i,batchSizeLimit:r}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:i,batchSizeLimit:r})},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4),...this.fetchOptions});return await e_(e,"get server info"),e}),t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes(),t=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:t})}_cloneCurrentOTELContext(){let e=B(),t=z.getContextInstance();if(void 0!==this.langSmithToOTELTranslator){let i=e.getActiveSpan();if(i)return e.setSpan(t.active(),i)}}async createRun(e,t){if(!this._filterForSampling([e]).length)return;let i={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){let e=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:a,otelContext:e,apiKey:t?.apiKey,apiUrl:t?.apiUrl}).catch(console.error);return}let s=eC(a,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);t?.apiKey!==void 0&&(i["x-api-key"]=t.apiKey),t?.workspaceId!==void 0&&(i["x-tenant-id"]=t.workspaceId);let n=eN(s,`Creating run with id: ${s.id}`);await this.caller.call(async()=>{let e=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await e_(e,"create run",!0),e})}async batchIngestRuns({runCreates:e,runUpdates:t},i){if(void 0===e&&void 0===t)return;let r=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),a=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(r.length>0&&a.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let i of a)void 0!==i.id&&e[i.id]?e[i.id]={...e[i.id],...i}:t.push(i);r=Object.values(e),a=t}let s={post:r,patch:a};if(!s.post.length&&!s.patch.length)return;let n={post:[],patch:[]};for(let e of["post","patch"]){let t=s[e].reverse(),i=t.pop();for(;void 0!==i;)n[e].push(i),i=t.pop()}if(n.post.length>0||n.patch.length>0){let e=n.post.map(e=>e.id).concat(n.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(eN(n,`Ingesting runs with ids: ${e}`),i)}}async _postBatchIngestRuns(e,t){let i={...this.headers,"Content-Type":"application/json",Accept:"application/json"};t?.apiKey!==void 0&&(i["x-api-key"]=t.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:t?.sizeBytes},async()=>{let r=await this._fetch(`${t?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await e_(r,"batch create run",!0),r})}async multipartIngestRuns({runCreates:e,runUpdates:t},i){if(void 0===e&&void 0===t)return;let r={},a=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(r[e.id]=e.attachments),delete e.attachments,a.push(e)}let s=[];for(let e of t??[])s.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==s.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&s.length>0){let e=a.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let i of s)void 0!==i.id&&e[i.id]?e[i.id]={...e[i.id],...i}:t.push(i);a=Object.values(e),s=t}if(0===a.length&&0===s.length)return;let n=[],o=[];for(let[e,t]of[["post",a],["patch",s]])for(let i of t){let{inputs:t,outputs:a,events:s,extra:l,error:u,serialized:h,attachments:c,...d}=i,p={inputs:t,outputs:a,events:s,extra:l,error:u,serialized:h},m=eN(d,`Serializing for multipart ingestion of run with id: ${d.id}`);for(let[t,i]of(o.push({name:`${e}.${d.id}`,payload:new Blob([m],{type:`application/json; length=${m.length}`})}),Object.entries(p))){if(void 0===i)continue;let r=eN(i,`Serializing ${t} for multipart ingestion of run with id: ${d.id}`);o.push({name:`${e}.${d.id}.${t}`,payload:new Blob([r],{type:`application/json; length=${r.length}`})})}if(void 0!==d.id){let e=r[d.id];if(e)for(let[t,i]of(delete r[d.id],Object.entries(e))){let e,r;if(Array.isArray(i)?[e,r]=i:(e=i.mimeType,r=i.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${d.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}o.push({name:`attachment.${d.id}.${t}`,payload:new Blob([r],{type:`${e}; length=${r.byteLength}`})})}}n.push(`trace=${d.trace_id},id=${d.id}`)}await this._sendMultipartRequest(o,n.join("; "),i)}async _createNodeFetchBody(e,t){let i=[];for(let r of e)i.push(new Blob([`--${t}\r
`])),i.push(new Blob([`Content-Disposition: form-data; name="${r.name}"\r
`,`Content-Type: ${r.payload.type}\r
\r
`])),i.push(r.payload),i.push(new Blob(["\r\n"]));i.push(new Blob([`--${t}--\r
`]));let r=new Blob(i);return await r.arrayBuffer()}async _createMultipartStream(e,t){let i=new TextEncoder;return new ReadableStream({async start(r){let a=async e=>{"string"==typeof e?r.enqueue(i.encode(e)):r.enqueue(e)};for(let i of e){await a(`--${t}\r
`),await a(`Content-Disposition: form-data; name="${i.name}"\r
`),await a(`Content-Type: ${i.payload.type}\r
\r
`);let e=i.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)r.enqueue(t.value)}finally{e.releaseLock()}await a("\r\n")}await a(`--${t}--\r
`),r.close()}})}async _sendMultipartRequest(e,t,i){let r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=eI(),s=()=>this._createNodeFetchBody(e,r),n=async e=>this.batchIngestCaller.callWithOptions({sizeBytes:i?.sizeBytes},async()=>{let t=await e(),a={...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`};i?.apiKey!==void 0&&(a["x-api-key"]=i.apiKey);let s=t;i?.useGzip&&"object"==typeof t&&"pipeThrough"in t&&(s=t.pipeThrough(new CompressionStream("gzip")),a["Content-Encoding"]="gzip");let n=await this._fetch(`${i?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:a,body:s,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(n,"Failed to send multipart request",!0),n});try{let o;let l=!1;a||this.multipartStreamingDisabled||"bun"===$()?o=await n(s):(l=!0,o=await n(()=>this._createMultipartStream(e,r))),(!this.multipartStreamingDisabled||l)&&422===o.status&&(i?.apiUrl??this.apiUrl)!==ez&&(console.warn(`Streaming multipart upload to ${i?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${t}".`),this.multipartStreamingDisabled=!0,o=await n(s))}catch(e){if(ef(e))throw e;console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t,i){ec(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){let e=this._cloneCurrentOTELContext();void 0!==t.end_time&&void 0===r.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?await this.processRunOperation({action:"update",item:r,otelContext:e,apiKey:i?.apiKey,apiUrl:i?.apiUrl}).catch(console.error):this.processRunOperation({action:"update",item:r,otelContext:e,apiKey:i?.apiKey,apiUrl:i?.apiUrl}).catch(console.error);return}let a={...this.headers,"Content-Type":"application/json"};i?.apiKey!==void 0&&(a["x-api-key"]=i.apiKey),i?.workspaceId!==void 0&&(a["x-tenant-id"]=i.workspaceId);let s=eN(t,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{let t=await this._fetch(`${i?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await e_(t,"update run",!0),t})}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){ec(e);let i=await this._get(`/runs/${e}`);return t&&(i=await this._loadChildRuns(i)),i}async getRunUrl({runId:e,run:t,projectOpts:i}){if(void 0!==t){let e;e=t.session_id?t.session_id:i?.projectName?(await this.readProject({projectName:i?.projectName})).id:i?.projectId?i?.projectId:(await this.readProject({projectName:R("PROJECT")||"default"})).id;let r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let i=this.getHostUrl();return`${i}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await ek(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),i={},r={};for(let a of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===a.parent_run_id||void 0===a.parent_run_id)throw Error(`Child run ${a.id} has no parent`);a.dotted_order?.startsWith(e.dotted_order??"")&&a.id!==e.id&&(a.parent_run_id in i||(i[a.parent_run_id]=[]),i[a.parent_run_id].push(a),r[a.id]=a)}for(let t in e.child_runs=i[e.id]||[],i)t!==e.id&&(r[t].child_runs=i[t]);return e}async *listRuns(e){let{projectId:t,projectName:i,parentRunId:r,traceId:a,referenceExampleId:s,startTime:n,executionOrder:o,isRoot:l,runType:u,error:h,id:c,query:d,filter:p,traceFilter:m,treeFilter:f,limit:_,select:g,order:y}=e,b=[];if(t&&(b=Array.isArray(t)?t:[t]),i){let e=Array.isArray(i)?i:[i],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));b.push(...t)}let w={session:b.length?b:null,run_type:u,reference_example:s,query:d,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:r,start_time:n?n.toISOString():null,error:h,id:c,limit:_,trace:a,select:g||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:y};w.select.includes("child_run_ids")&&eu("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let v=0;for await(let e of this._getCursorPaginatedList("/runs/query",w))if(_){if(v>=_)break;if(e.length+v>_){let t=e.slice(0,_-v);yield*t;break}v+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:i,groupBy:r,filter:a,startTime:s,endTime:n,limit:o,offset:l}=e,u={session_id:t||(await this.readProject({projectName:i})).id,group_by:r,filter:a,start_time:s?s.toISOString():null,end_time:n?n.toISOString():null,limit:Number(o)||100},h=Number(l)||0,c="/runs/group",d=`${this.apiUrl}${c}`;for(;;){let e=JSON.stringify(Object.fromEntries(Object.entries({...u,offset:h}).filter(([e,t])=>void 0!==t))),t=await this.caller.call(async()=>{let t=await this._fetch(d,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await e_(t,`Failed to fetch ${c}`),t}),{groups:i,total:r}=await t.json();if(0===i.length)break;for(let e of i)yield e;if((h+=i.length)>=r)break}}async getRunStats({id:e,trace:t,parentRun:i,runType:r,projectNames:a,projectIds:s,referenceExampleIds:n,startTime:o,endTime:l,error:u,query:h,filter:c,traceFilter:d,treeFilter:p,isRoot:m,dataSourceType:f}){let _=s||[];a&&(_=[...s||[],...await Promise.all(a.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let g=JSON.stringify(Object.fromEntries(Object.entries({id:e,trace:t,parent_run:i,run_type:r,session:_,reference_example:n,start_time:o,end_time:l,error:u,query:h,filter:c,trace_filter:d,tree_filter:p,is_root:m,data_source_type:f}).filter(([e,t])=>void 0!==t))),y=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:g});return await e_(e,"get run stats"),e});return await y.json()}async shareRun(e,{shareId:t}={}){let i={run_id:e,share_token:t||f()};ec(e);let r=JSON.stringify(i),a=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await e_(t,"share run"),t}),s=await a.json();if(null===s||!("share_token"in s))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){ec(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"unshare run",!0),t})}async readRunSharedLink(e){ec(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"read run shared link"),t}),i=await t.json();if(null!==i&&"share_token"in i)return`${this.getHostUrl()}/public/${i.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let i=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)i.append("id",e);ec(e);let r=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/runs${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"list shared runs"),t});return await r.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),ec(e);let i=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"read dataset shared schema"),t}),r=await i.json();return r.url=`${this.getHostUrl()}/public/${r.share_token}/d`,r}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let i={dataset_id:e};ec(e);let r=JSON.stringify(i),a=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await e_(t,"share dataset"),t}),s=await a.json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){ec(e),await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"unshare dataset",!0),t})}async readSharedDataset(e){ec(e);let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"read shared dataset"),t});return await t.json()}async listSharedExamples(e,t){let i={};t?.exampleIds&&(i.id=t.exampleIds);let r=new URLSearchParams;Object.entries(i).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>r.append(e,t)):r.append(e,t)});let a=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/public/${e}/examples?${r.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"list shared examples"),t}),s=await a.json();if(!a.ok){if("detail"in s)throw Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(s.detail)?s.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${a.status} ${a.statusText}`)}return s.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:i=null,upsert:r=!1,projectExtra:a=null,referenceDatasetId:s=null}){let n=`${this.apiUrl}/sessions${r?"?upsert=true":""}`,o=a||{};i&&(o.metadata=i);let l={name:e,extra:o,description:t};null!==s&&(l.reference_dataset_id=s);let u=JSON.stringify(l),h=await this.caller.call(async()=>{let e=await this._fetch(n,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await e_(e,"create project"),e});return await h.json()}async updateProject(e,{name:t=null,description:i=null,metadata:r=null,projectExtra:a=null,endTime:s=null}){let n=`${this.apiUrl}/sessions/${e}`,o=a;r&&(o={...o||{},metadata:r});let l=JSON.stringify({name:t,extra:o,description:i,end_time:s?new Date(s).toISOString():null}),u=await this.caller.call(async()=>{let e=await this._fetch(n,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await e_(e,"update project"),e});return await u.json()}async hasProject({projectId:e,projectName:t}){let i="/sessions",r=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)ec(e),i+=`/${e}`;else if(void 0!==t)r.append("name",t);else throw Error("Must provide projectName or projectId");let a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${i}?${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,"has project"),e});try{let e=await a.json();if(!a.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:i}){let r,a="/sessions",s=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)ec(e),a+=`/${e}`;else if(void 0!==t)s.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==i&&s.append("include_stats",i.toString());let n=await this._get(a,s);if(Array.isArray(n)){if(0===n.length)throw Error(`Project[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let i=await this.readProject({projectId:e,projectName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/projects/p/${i.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let i=await this.readDataset({datasetId:e,datasetName:t}),r=await this._getTenantId();return`${this.getHostUrl()}/o/${r}/datasets/${i.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:i,referenceDatasetId:r,referenceDatasetName:a,includeStats:s,datasetVersion:n,referenceFree:o,metadata:l}={}){let u=new URLSearchParams;if(void 0!==e)for(let t of e)u.append("id",t);if(void 0!==t&&u.append("name",t),void 0!==i&&u.append("name_contains",i),void 0!==r)u.append("reference_dataset",r);else if(void 0!==a){let e=await this.readDataset({datasetName:a});u.append("reference_dataset",e.id)}for await(let e of(void 0!==s&&u.append("include_stats",s.toString()),void 0!==n&&u.append("dataset_version",n),void 0!==o&&u.append("reference_free",o.toString()),void 0!==l&&u.append("metadata",JSON.stringify(l)),this._getPaginated("/sessions",u)))yield*e}async deleteProject({projectId:e,projectName:t}){let i;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");ec(i=void 0===e?(await this.readProject({projectName:t})).id:e),await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/sessions/${i}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,`delete session ${i} (${t})`,!0),e})}async uploadCsv({csvFile:e,fileName:t,inputKeys:i,outputKeys:r,description:a,dataType:s,name:n}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),i.forEach(e=>{l.append("input_keys",e)}),r.forEach(e=>{l.append("output_keys",e)}),a&&l.append("description",a),s&&l.append("data_type",s),n&&l.append("name",n);let u=await this.caller.call(async()=>{let e=await this._fetch(o,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await e_(e,"upload CSV"),e});return await u.json()}async createDataset(e,{description:t,dataType:i,inputsSchema:r,outputsSchema:a,metadata:s}={}){let n={name:e,description:t,extra:s?{metadata:s}:void 0};i&&(n.data_type=i),r&&(n.inputs_schema_definition=r),a&&(n.outputs_schema_definition=a);let o=JSON.stringify(n),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await e_(e,"create dataset"),e});return await l.json()}async readDataset({datasetId:e,datasetName:t}){let i,r="/datasets",a=new URLSearchParams({limit:"1"});if(e&&t)throw Error("Must provide either datasetName or datasetId, not both");if(e)ec(e),r+=`/${e}`;else if(t)a.append("name",t);else throw Error("Must provide datasetName or datasetId");let s=await this._get(r,a);if(Array.isArray(s)){if(0===s.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:i,toVersion:r}){let a=e;if(void 0===a&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:t})).id);let s=new URLSearchParams({from_version:"string"==typeof i?i:i.toISOString(),to_version:"string"==typeof r?r:r.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let i=await this._getResponse(`/datasets/${e}/openai_ft`);return(await i.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:i,datasetName:r,datasetNameContains:a,metadata:s}={}){let n=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==i)for(let e of i)n.append("id",e);for await(let e of(void 0!==r&&n.append("name",r),void 0!==a&&n.append("name_contains",a),void 0!==s&&n.append("metadata",JSON.stringify(s)),this._getPaginated("/datasets",n)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:i,...r}=e;if(!t&&!i)throw Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:i})).id;ec(a);let s=JSON.stringify(r),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await e_(e,"update dataset"),e});return await n.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:i,asOf:r,tag:a}=e;if(!t&&!i)throw Error("Must provide either datasetName or datasetId");let s=t??(await this.readDataset({datasetName:i})).id;ec(s);let n=JSON.stringify({as_of:"string"==typeof r?r:r.toISOString(),tag:a});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await e_(e,"update dataset tags",!0),e})}async deleteDataset({datasetId:e,datasetName:t}){let i="/datasets",r=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(r=(await this.readDataset({datasetName:t})).id),void 0!==r)ec(r),i+=`/${r}`;else throw Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+i,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,`delete ${i}`,!0),e})}async indexDataset({datasetId:e,datasetName:t,tag:i}){let r=e;if(r||t){if(r&&t)throw Error("Must provide either datasetName or datasetId, not both");r||(r=(await this.readDataset({datasetName:t})).id)}else throw Error("Must provide either datasetName or datasetId");ec(r);let a=JSON.stringify({tag:i}),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${r}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await e_(e,"index dataset"),e});await s.json()}async similarExamples(e,t,i,{filter:r}={}){let a={limit:i,inputs:e};void 0!==r&&(a.filter=r),ec(t);let s=JSON.stringify(a),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${t}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:s});return await e_(e,"fetch similar examples"),e});return(await n.json()).examples}async createExample(e,t,i){let r;if(eq(e)&&(void 0!==t||void 0!==i))throw Error("Cannot provide outputs or options when using ExampleCreate object");let a=t?i?.datasetId:e.dataset_id,s=t?i?.datasetName:e.dataset_name;if(void 0===a&&void 0===s)throw Error("Must provide either datasetName or datasetId");if(void 0!==a&&void 0!==s)throw Error("Must provide either datasetName or datasetId, not both");void 0===a&&(a=(await this.readDataset({datasetName:s})).id);let n=(t?i?.createdAt:e.created_at)||new Date;r=eq(e)?e:{inputs:e,outputs:t,created_at:n?.toISOString(),id:i?.exampleId,metadata:i?.metadata,split:i?.split,source_run_id:i?.sourceRunId,use_source_run_io:i?.useSourceRunIO,use_source_run_attachments:i?.useSourceRunAttachments,attachments:i?.attachments};let o=await this._uploadExamplesMultipart(a,[r]);return await this.readExample(o.example_ids?.[0]??f())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,i=e[0].dataset_name;if(void 0===t&&void 0===i)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:i})).id);let r=await this._uploadExamplesMultipart(t,e);return await Promise.all(r.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:i,metadata:r,splits:a,sourceRunIds:s,useSourceRunIOs:n,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:h,datasetName:c}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let d=h;if(void 0===d&&void 0===c)throw Error("Must provide either datasetName or datasetId");if(void 0!==d&&void 0!==c)throw Error("Must provide either datasetName or datasetId, not both");void 0===d&&(d=(await this.readDataset({datasetName:c})).id);let p=t.map((e,t)=>({dataset_id:d,inputs:e,outputs:i?.[t],metadata:r?.[t],split:a?.[t],id:u?.[t],attachments:l?.[t],source_run_id:s?.[t],use_source_run_io:n?.[t],use_source_run_attachments:o?.[t]})),m=await this._uploadExamplesMultipart(d,p);return await Promise.all(m.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,i){return this.createExample({input:e},{output:t},i)}async createChatExample(e,t,i){let r=e.map(e=>ei(e)?er(e):e),a=ei(t)?er(t):t;return this.createExample({input:r},{output:a},i)}async readExample(e){ec(e);let t=`/examples/${e}`,{attachment_urls:i,...r}=await this._get(t);return i&&(r.attachments=Object.entries(i).reduce((e,[t,i])=>(e[t.slice("attachment.".length)]={presigned_url:i.presigned_url,mime_type:i.mime_type},e),{})),r}async *listExamples({datasetId:e,datasetName:t,exampleIds:i,asOf:r,splits:a,inlineS3Urls:s,metadata:n,limit:o,offset:l,filter:u,includeAttachments:h}={}){let c;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)c=e;else if(void 0!==t)c=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let d=new URLSearchParams({dataset:c}),p=r?"string"==typeof r?r:r?.toISOString():void 0;if(p&&d.append("as_of",p),d.append("inline_s3_urls",(s??!0).toString()),void 0!==i)for(let e of i)d.append("id",e);if(void 0!==a)for(let e of a)d.append("splits",e);if(void 0!==n){let e=JSON.stringify(n);d.append("metadata",e)}void 0!==o&&d.append("limit",o.toString()),void 0!==l&&d.append("offset",l.toString()),void 0!==u&&d.append("filter",u),!0===h&&["attachment_urls","outputs","metadata"].forEach(e=>d.append("select",e));let m=0;for await(let e of this._getPaginated("/examples",d)){for(let t of e){let{attachment_urls:e,...i}=t;e&&(i.attachments=Object.entries(e).reduce((e,[t,i])=>(e[t.slice("attachment.".length)]={presigned_url:i.presigned_url,mime_type:i.mime_type||void 0},e),{})),yield i,m++}if(void 0!==o&&m>=o)break}}async deleteExample(e){ec(e);let t=`/examples/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,`delete ${t}`,!0),e})}async deleteExamples(e,t){if(e.forEach(e=>ec(e)),t?.hardDelete){let t=this._getPlatformEndpointPath("datasets/examples/delete");await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}${t}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({example_ids:e,hard_delete:!0}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(i,"hard delete examples",!0),i})}else{let t=new URLSearchParams;e.forEach(e=>t.append("example_ids",e)),await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/examples?${t.toString()}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,"delete examples",!0),e})}}async updateExample(e,t){let i,r,a;return ec(i=t?e:e.id),a=void 0!==(r=t?{id:i,...t}:e).dataset_id?r.dataset_id:(await this.readExample(i)).dataset_id,this._updateExamplesMultipart(a,[r])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:i,tag:r}){let a;if(ec(a=e||(await this.readDataset({datasetName:t})).id),i&&r||!i&&!r)throw Error("Exactly one of asOf and tag must be specified.");let s=new URLSearchParams;void 0!==i&&s.append("as_of","string"==typeof i?i:i.toISOString()),void 0!==r&&s.append("tag",r);let n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${a}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,"read dataset version"),e});return await n.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:i}){let r;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");ec(r=void 0===e?(await this.readDataset({datasetName:t})).id:e);let a=new URLSearchParams,s=i?"string"==typeof i?i:i?.toISOString():void 0;return s&&a.append("as_of",s),await this._get(`/datasets/${r}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:i,exampleIds:r,remove:a=!1}){let s;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");ec(s=void 0===e?(await this.readDataset({datasetName:t})).id:e);let n=JSON.stringify({split_name:i,examples:r.map(e=>(ec(e),e)),remove:a});await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await e_(e,"update dataset splits",!0),e})}async createFeedback(e,t,{score:i,value:r,correction:a,comment:s,sourceInfo:n,feedbackSourceType:o="api",sourceRunId:l,feedbackId:u,feedbackConfig:h,projectId:c,comparativeExperimentId:d}){if(!e&&!c)throw Error("One of runId or projectId must be provided");if(e&&c)throw Error("Only one of runId or projectId can be provided");let p={type:o??"api",metadata:n??{}};void 0===l||p?.metadata===void 0||p.metadata.__run||(p.metadata.__run={run_id:l}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&ec(p.metadata.__run.run_id);let m={id:u??f(),run_id:e,key:t,score:eF(i),value:r,correction:a,comment:s,feedback_source:p,comparative_experiment_id:d,feedbackConfig:h,session_id:c},_=JSON.stringify(m),g=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{let e=await this._fetch(g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:_});return await e_(e,"create feedback",!0),e}),m}async updateFeedback(e,{score:t,value:i,correction:r,comment:a}){let s={};null!=t&&(s.score=eF(t)),null!=i&&(s.value=i),null!=r&&(s.correction=r),null!=a&&(s.comment=a),ec(e);let n=JSON.stringify(s);await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await e_(t,"update feedback",!0),t})}async readFeedback(e){ec(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){ec(e);let t=`/feedback/${e}`;await this.caller.call(async()=>{let e=await this._fetch(this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,`delete ${t}`,!0),e})}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:i}={}){let r=new URLSearchParams;if(e)for(let t of e)ec(t),r.append("run",t);if(t)for(let e of t)r.append("key",e);if(i)for(let e of i)r.append("source",e);for await(let e of this._getPaginated("/feedback",r))yield*e}async createPresignedFeedbackToken(e,t,{expiration:i,feedbackConfig:r}={}){let a={run_id:e,feedback_key:t,feedback_config:r};i?"string"==typeof i?a.expires_at=i:(i?.hours||i?.minutes||i?.days)&&(a.expires_in=i):a.expires_in={hours:3};let s=JSON.stringify(a),n=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await e_(e,"create presigned feedback token"),e});return await n.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:i,createdAt:r,description:a,metadata:s,id:n}){if(0===t.length)throw Error("At least one experiment is required");if(i||(i=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!i)throw Error("A reference dataset is required");let o={id:n,name:e,experiment_ids:t,reference_dataset_id:i,description:a,created_at:(r??new Date)?.toISOString(),extra:{}};s&&(o.extra.metadata=s);let l=JSON.stringify(o);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await e_(e,"create comparative experiment"),e})).json()}async *listPresignedFeedbackTokens(e){ec(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,i){let r=this._selectEvalResults(e),a=[];for(let e of r){let r=i||{};e.evaluatorInfo&&(r={...e.evaluatorInfo,...r});let s=null;e.targetRunId?s=e.targetRunId:t&&(s=t.id),a.push(await this.createFeedback(s,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:r,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[r,a]}async logEvaluationFeedback(e,t,i){let[r]=await this._logEvaluationFeedback(e,t,i);return r}async *listAnnotationQueues(e={}){let{queueIds:t,name:i,nameContains:r,limit:a}=e,s=new URLSearchParams;t&&t.forEach((e,t)=>{ec(e,`queueIds[${t}]`),s.append("ids",e)}),i&&s.append("name",i),r&&s.append("name_contains",r),s.append("limit",(void 0!==a?Math.min(a,100):100).toString());let n=0;for await(let e of this._getPaginated("/annotation-queues",s))if(yield*e,n++,void 0!==a&&n>=a)break}async createAnnotationQueue(e){let{name:t,description:i,queueId:r,rubricInstructions:a}=e,s=JSON.stringify(Object.fromEntries(Object.entries({name:t,description:i,id:r||f(),rubric_instructions:a}).filter(([e,t])=>void 0!==t)));return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await e_(e,"create annotation queue"),e})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${ec(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"read annotation queue"),t})).json()}async updateAnnotationQueue(e,t){let{name:i,description:r,rubricInstructions:a}=t,s=JSON.stringify({name:i,description:r,rubric_instructions:a});await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${ec(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await e_(t,"update annotation queue",!0),t})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${ec(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"delete annotation queue",!0),t})}async addRunsToAnnotationQueue(e,t){let i=JSON.stringify(t.map((e,t)=>ec(e,`runIds[${t}]`).toString()));await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${ec(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await e_(t,"add runs to annotation queue",!0),t})}async getRunFromAnnotationQueue(e,t){let i=`/annotation-queues/${ec(e,"queueId")}/run`;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${i}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,"get run from annotation queue"),e})).json()}async deleteRunFromAnnotationQueue(e,t){await this.caller.call(async()=>{let i=await this._fetch(`${this.apiUrl}/annotation-queues/${ec(e,"queueId")}/runs/${ec(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(i,"delete run from annotation queue",!0),i})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/annotation-queues/${ec(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"get size from annotation queue"),t})).json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let i=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${i.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(t,"get latest commit hash"),t}),i=await t.json();if(0!==i.commits.length)return i.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[i,r,a]=ed(e),s=JSON.stringify({like:t});return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/likes/${i}/${r}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await e_(e,`${t?"like":"unlike"} prompt`),e})).json()}async _getPromptUrl(e){let[t,i,r]=ed(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==r?`${this.getHostUrl()}/prompts/${i}/${r.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${i}?organizationId=${e.id}`}return"latest"!==r?`${this.getHostUrl()}/hub/${t}/${i}/${r.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${i}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let i of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*i}async getPrompt(e){let[t,i,r]=ed(e),a=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return e?.status===404?null:(await e_(e,"get prompt"),e)}),s=await a?.json();return s?.repo?s.repo:null}async createPrompt(e,t){let i=await this._getSettings();if(t?.isPublic&&!i.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[r,a,s]=ed(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("create a prompt",r);let n=JSON.stringify({repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic}),o=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await e_(e,"create prompt"),e}),{repo:l}=await o.json();return l}async createCommit(e,t,i){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,a,s]=ed(e),n=i?.parentCommitHash!=="latest"&&i?.parentCommitHash?i?.parentCommitHash:await this._getLatestCommitHash(`${r}/${a}`),o=JSON.stringify({manifest:JSON.parse(JSON.stringify(t)),parent_commit:n}),l=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${r}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await e_(e,"create commit"),e}),u=await l.json();return this._getPromptUrl(`${r}/${a}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let e of t){let t=e.id,r=new Blob([eN({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`)],{type:"application/json"});if(i.append(t,r),e.inputs){let r=new Blob([eN(e.inputs,`Serializing inputs for example with id: ${t}`)],{type:"application/json"});i.append(`${t}.inputs`,r)}if(e.outputs){let r=new Blob([eN(e.outputs,`Serializing outputs whle updating example with id: ${t}`)],{type:"application/json"});i.append(`${t}.outputs`,r)}if(e.attachments)for(let[r,a]of Object.entries(e.attachments)){let e,s;Array.isArray(a)?[e,s]=a:(e=a.mimeType,s=a.data);let n=new Blob([s],{type:`${e}; length=${s.byteLength}`});i.append(`${t}.attachment.${r}`,n)}if(e.attachments_operations){let r=new Blob([eN(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`)],{type:"application/json"});i.append(`${t}.attachments_operations`,r)}}let r=e??t[0]?.dataset_id;return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${r}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await e_(e,"update examples"),e})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let i=new FormData;for(let e of t){let t=(e.id??f()).toString(),r=new Blob([eN({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`)],{type:"application/json"});if(i.append(t,r),e.inputs){let r=new Blob([eN(e.inputs,`Serializing inputs for uploaded example with id: ${t}`)],{type:"application/json"});i.append(`${t}.inputs`,r)}if(e.outputs){let r=new Blob([eN(e.outputs,`Serializing outputs for uploaded example with id: ${t}`)],{type:"application/json"});i.append(`${t}.outputs`,r)}if(e.attachments)for(let[r,a]of Object.entries(e.attachments)){let e,s;Array.isArray(a)?[e,s]=a:(e=a.mimeType,s=a.data);let n=new Blob([s],{type:`${e}; length=${s.byteLength}`});i.append(`${t}.attachment.${r}`,n)}}return(await this.caller.call(async()=>{let t=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:i});return await e_(t,"upload examples"),t})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[i,r]=ed(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("update a prompt",i);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),0===Object.keys(a).length)throw Error("No valid update options provided");let s=JSON.stringify(a);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${i}/${r}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await e_(e,"update prompt"),e})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,i,r]=ed(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return(await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/repos/${t}/${i}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,"delete prompt"),e})).json()}_getPromptCacheKey(e,t){return`${e}${t?":with_model":""}`}_makeFetchPromptFunc(){return async e=>{let t=e.endsWith(":with_model"),i=t?e.slice(0,-11):e;return this._fetchPromptFromApi(i,{includeModel:t})}}async _fetchPromptFromApi(e,t){let[i,r,a]=ed(e),s=await this.caller.call(async()=>{let e=await this._fetch(`${this.apiUrl}/commits/${i}/${r}/${a}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await e_(e,"pull prompt commit"),e}),n=await s.json();return{owner:i,repo:r,commit_hash:n.commit_hash,manifest:n.manifest,examples:n.examples}}async pullPromptCommit(e,t){if(!t?.skipCache&&this._promptCache){let i=this._getPromptCacheKey(e,t?.includeModel),r=this._promptCache.get(i);if(r)return r;let a=await this._fetchPromptFromApi(e,t);return this._promptCache.set(i,a),a}return this._fetchPromptFromApi(e,t)}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel,skipCache:t?.skipCache})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:i=this.apiUrl,datasetName:r}=t,[a,s]=this.parseTokenOrUrl(e,i),n=new eG({apiUrl:a,apiKey:"placeholder"}),o=await n.readSharedDataset(s),l=r||o.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch(e){}let u=await n.listSharedExamples(s),h=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:h.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,i=2,r="dataset"){try{return ec(e),[t,e]}catch(e){}try{let a=new URL(e).pathname.split("/").filter(e=>""!==e);if(a.length>=i){let e=a[a.length-i];return[t,e]}throw Error(`Invalid public ${r} URL: ${e}`)}catch(t){throw Error(`Invalid public ${r} URL or token: ${e}`)}}get promptCache(){return this._promptCache}cleanup(){this._promptCache&&this._promptCache.stop()}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await new Promise(e=>setTimeout(e,1)),await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),void 0!==this.langSmithToOTELTranslator&&await z.getDefaultOTLPTracerComponents()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function eq(e){return"dataset_id"in e||"dataset_name"in e}let eH=e=>void 0!==e?e:!!["TRACING_V2","TRACING"].find(e=>"true"===R(e)),eJ=Symbol.for("lc:context_variables");Symbol.for("lc:child_run_end_promises");let eK=Symbol.for("langsmith:replica_trace_roots");function eW(e,t){if(eJ in e)return e[eJ][t]}let eV=()=>R("PROJECT")??A("LANGCHAIN_SESSION")??"default",eX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,eQ=function(e){let t;if(!("string"==typeof e&&eX.test(e)))throw TypeError("Invalid UUID");let i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i},eY=function(e,t,i){function r(e,t,r,a){var s;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));let t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),"string"==typeof t&&(t=eQ(t)),(null===(s=t)||void 0===s?void 0:s.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let n=new Uint8Array(16+e.length);if(n.set(t),n.set(e,t.length),(n=i(n))[6]=15&n[6]|80,n[8]=63&n[8]|128,r){a=a||0;for(let e=0;e<16;++e)r[a+e]=n[e];return r}return m(n)}try{r.name="v5"}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}(0,0,function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),l().createHash("sha1").update(e).digest()}),eZ="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function e0(e){return eY(Object.keys(e).sort().map(t=>`${t}:${e[t]??""}`).join("|"),eZ)}function e1(e,t=1){let i=t.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${i}Z`}class e2{constructor(e,t,i,r){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=i,this.replicas=r}static fromHeader(e){let t,i;let r=e.split(","),a={},s=[];for(let e of r){let[r,n]=e.split("="),o=decodeURIComponent(n);"langsmith-metadata"===r?a=JSON.parse(o):"langsmith-tags"===r?s=o.split(","):"langsmith-project"===r?t=o:"langsmith-replicas"===r&&(i=JSON.parse(o))}return new e2(a,s,t,i)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class e8{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_awaitInputsOnPost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){return null!=e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}(e)){Object.assign(this,{...e});return}let t=e8.getDefaultConfig(),{metadata:i,...r}=e,a=r.client??e8.getSharedClient(),s={...i,...r?.extra?.metadata};if(r.extra={...r.extra,metadata:s},"id"in r&&null==r.id&&delete r.id,Object.assign(this,{...t,...r,client:a}),this.execution_order??=1,this.child_execution_order??=1,this.dotted_order||(this._serialized_start_time=e1(this.start_time,this.execution_order)),this.id||(this.id=function(e){return eo({msecs:"string"==typeof e?Date.parse(e):e,seq:0})}(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=function(e){return e?e.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):function(){let e=A("LANGSMITH_RUNS_ENDPOINTS");if(!e)return[];try{let t=JSON.parse(e);if(Array.isArray(t)){let e=[];for(let i of t){if("object"!=typeof i||null===i){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof i}`);continue}if("string"!=typeof i.api_url){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof i.api_url}`);continue}if("string"!=typeof i.api_key){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof i.api_key}`);continue}e.push({apiUrl:i.api_url.replace(/\/$/,""),apiKey:i.api_key})}return e}if("object"!=typeof t||null===t)return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS – must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof t}`),[];{(function(e){if(Object.keys(e).length>0&&R("ENDPOINT"))throw new ey})(t);let e=[];for(let[i,r]of Object.entries(t)){let t=i.replace(/\/$/,"");if("string"==typeof r)e.push({apiUrl:t,apiKey:r});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${i}: expected string, got ${typeof r}`);continue}}return e}}catch(e){if("object"==typeof e&&null!==e&&e.code===eg)throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS – must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}()}(this.replicas),!this.dotted_order){let{dottedOrder:e}=function(e,t,i=1){let r=e1(e,i);return{dottedOrder:r.replace(/[-:.]/g,"")+t,microsecondPrecisionDatestring:r}}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){let e=Date.now();return{run_type:"chain",project_name:eV(),child_runs:[],api_url:A("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:A("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return e8.sharedClient||(e8.sharedClient=new eG),e8.sharedClient}createChild(e){let t=this.child_execution_order+1,i=this.replicas?.map(e=>{let{reroot:t,...i}=e;return i}),r=e.replicas??i,a=new e8({...e,parent_run:this,project_name:this.project_name,replicas:r,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});eJ in this&&(a[eJ]=this[eJ]);let s=Symbol.for("lc:child_config"),n=e.extra?.[s]??this.extra[s];if(function(e){let t=e?.callbacks;return null!=e&&"object"==typeof t&&(e4(t?.handlers)||e4(t))}(n)){var o;let e={...n},t="object"==typeof(o=e.callbacks)&&null!=o&&Array.isArray(o.handlers)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:a.id}),t.handlers?.find(e5)?.updateFromRunTree?.(a),e.callbacks=t),a.extra[s]=e}let l=new Set,u=this;for(;null!=u&&!l.has(u.id);)l.add(u.id),u.child_execution_order=Math.max(u.child_execution_order,t),u=u.parent_run;return this.child_runs.push(a),a}async end(e,t,i=Date.now(),r){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??i,r&&Object.keys(r).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...r}}:{metadata:r})}_convertToCreate(e,t,i=!0){let r,a;let s=e.extra??{};if(s?.runtime?.library===void 0&&(s.runtime||(s.runtime={}),t))for(let[e,i]of Object.entries(t))s.runtime[e]||(s.runtime[e]=i);return i?(a=e.parent_run?.id??e.parent_run_id,r=[]):(r=e.child_runs.map(e=>this._convertToCreate(e,t,i)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:r,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_sliceParentId(e,t){if(t.dotted_order){let i=t.dotted_order.split("."),r=null;for(let t=0;t<i.length;t++)if(i[t].slice(-36)===e){r=t;break}if(null!==r){let e=i.slice(r+1);t.dotted_order=e.join("."),e.length>0?t.trace_id=e[0].slice(-36):t.trace_id=t.id}}t.parent_run_id===e&&(t.parent_run_id=void 0)}_setReplicaTraceRoot(e,t){let i=eW(this,eK)??{};for(let r of(i[e]=t,function(e,t,i){let r=eJ in e?e[eJ]:{};r[t]=i,e[eJ]=r}(this,eK,i),this.child_runs))r._setReplicaTraceRoot(e,t)}_remapForProject(e){let t,i,r,a;let{projectName:s,runtimeEnv:n,excludeChildRuns:o=!0,reroot:l=!1,distributedParentId:u,apiUrl:h,apiKey:c,workspaceId:d}=e,p=this._convertToCreate(this,n,o);if(s===this.project_name)return{...p,session_name:s};if(l){if(u)this._sliceParentId(u,p);else if(p.parent_run_id=void 0,p.dotted_order){let e=p.dotted_order.split(".");e.length>0&&(p.dotted_order=e[e.length-1],p.trace_id=p.id)}let e=e0({projectName:s,apiUrl:h,apiKey:c,workspaceId:d});this._setReplicaTraceRoot(e,p.id)}if(!l&&(t=(eW(this,eK)??{})[e0({projectName:s,apiUrl:h,apiKey:c,workspaceId:d})])&&(p.trace_id=t,p.dotted_order)){let e=p.dotted_order.split("."),i=null;for(let r=0;r<e.length;r++)if(e[r].slice(-36)===t){i=r;break}if(null!==i){let t=e.slice(i);p.dotted_order=t.join(".")}}let m=p.id,f=eY(`${m}:${s}`,eZ);return i=p.trace_id?eY(`${p.trace_id}:${s}`,eZ):f,p.parent_run_id&&(r=eY(`${p.parent_run_id}:${s}`,eZ)),p.dotted_order&&(a=p.dotted_order.split(".").map(e=>{let t=e.slice(-36),i=eY(`${t}:${s}`,eZ);return e.slice(0,-36)+i}).join(".")),{...p,id:f,trace_id:i,parent_run_id:r,dotted_order:a,session_name:s}}async postRun(e=!0){this._awaitInputsOnPost&&(this.inputs=await this.inputs);try{let t=T();if(this.replicas&&this.replicas.length>0)for(let{projectName:e,apiKey:i,apiUrl:r,workspaceId:a,reroot:s}of this.replicas){let n=this._remapForProject({projectName:e??this.project_name,runtimeEnv:t,excludeChildRuns:!0,reroot:s,distributedParentId:this.distributedParentId,apiUrl:r,apiKey:i,workspaceId:a});await this.client.createRun(n,{apiKey:i,apiUrl:r,workspaceId:a})}else{let i=this._convertToCreate(this,t,e);await this.client.createRun(i)}if(!e)for(let e of(eu("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1);this.child_runs=[]}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(let{projectName:t,apiKey:i,apiUrl:r,workspaceId:a,updates:s,reroot:n}of this.replicas){let o=this._remapForProject({projectName:t??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:n,distributedParentId:this.distributedParentId,apiUrl:r,apiKey:i,workspaceId:a}),l={id:o.id,name:o.name,run_type:o.run_type,start_time:o.start_time,outputs:o.outputs,error:o.error,parent_run_id:o.parent_run_id,session_name:o.session_name,reference_example_id:o.reference_example_id,end_time:o.end_time,dotted_order:o.dotted_order,trace_id:o.trace_id,events:o.events,tags:o.tags,extra:o.extra,attachments:this.attachments,...s};e?.excludeInputs||(l.inputs=o.inputs),await this.client.updateRun(o.id,l,{apiKey:i,apiUrl:r,workspaceId:a})}else try{let t={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(t.inputs=this.inputs),await this.client.updateRun(this.id,t)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}this.child_runs=[]}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){let i,r,a;let s=e?.callbacks,n=eH();if(s){let e=s?.getParentRunId?.()??"",t=s?.handlers?.find(e=>e?.name=="langchain_tracer");i=t?.getRun?.(e),r=t?.projectName,a=t?.client,n=n||!!t}return i?new e8({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:n,project_name:r,tags:[...new Set((i?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...i?.extra?.metadata,...e?.metadata}}}).createChild(t):new e8({...t,client:a,tracingEnabled:n,project_name:r})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let i="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,r=i["langsmith-trace"];if(!r||"string"!=typeof r)return;let a=r.trim(),s=a.split(".").map(e=>{let[t,i]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:i}}),n=s[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:s.at(-1)?.uuid,trace_id:n,dotted_order:a};if(i.baggage&&"string"==typeof i.baggage){let e=e2.fromHeader(i.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}let l=new e8(o);return l.distributedParentId=l.id,l}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new e2(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[i,r]of Object.entries(t))e.set(i,r);return t}}function e5(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function e4(e){return Array.isArray(e)&&e.some(e=>e5(e))}Object.defineProperty(e8,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});let e6="0.4.4";function e9(){let e=new eG({apiKey:"test-key"});return(0,n.jsxs)("div",{children:[n.jsx("h1",{children:"LangSmith Next.js Test"}),(0,n.jsxs)("p",{children:["Client instantiated: ",e?"Yes":"No"]})]})}},866:e=>{"use strict";var t=Object.prototype.hasOwnProperty,i="~";function r(){}function a(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,r,s,n){if("function"!=typeof r)throw TypeError("The listener must be a function");var o=new a(r,s||e,n),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function n(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function o(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1)),o.prototype.eventNames=function(){var e,r,a=[];if(0===this._eventsCount)return a;for(r in e=this._events)t.call(e,r)&&a.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(e)):a},o.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,s=r.length,n=Array(s);a<s;a++)n[a]=r[a].fn;return n},o.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},o.prototype.emit=function(e,t,r,a,s,n){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,h=this._events[o],c=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),c){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,r),!0;case 4:return h.fn.call(h.context,t,r,a),!0;case 5:return h.fn.call(h.context,t,r,a,s),!0;case 6:return h.fn.call(h.context,t,r,a,s,n),!0}for(u=1,l=Array(c-1);u<c;u++)l[u-1]=arguments[u];h.fn.apply(h.context,l)}else{var d,p=h.length;for(u=0;u<p;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),c){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,r);break;case 4:h[u].fn.call(h[u].context,t,r,a);break;default:if(!l)for(d=1,l=Array(c-1);d<c;d++)l[d-1]=arguments[d];h[u].fn.apply(h[u].context,l)}}return!0},o.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,r,a){var s=i?i+e:e;if(!this._events[s])return this;if(!t)return n(this,s),this;var o=this._events[s];if(o.fn)o.fn!==t||a&&!o.once||r&&o.context!==r||n(this,s);else{for(var l=0,u=[],h=o.length;l<h;l++)(o[l].fn!==t||a&&!o[l].once||r&&o[l].context!==r)&&u.push(o[l]);u.length?this._events[s]=1===u.length?u[0]:u:n(this,s)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&n(this,t)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o},5099:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},9239:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=i(866),a=i(7871),s=i(7117),n=()=>{},o=new a.TimeoutError;class l extends r{constructor(e){var t,i,r,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=n,this._resolveIdle=n,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:s.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(i=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==i?i:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(a=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==a?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=n,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=n,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((i,r)=>{let s=async()=>{this._pendingCount++,this._intervalCount++;try{let s=void 0===this._timeout&&void 0===t.timeout?e():a.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&r(o)});i(await s)}catch(e){r(e)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}t.default=l},732:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){let r=0,a=e.length;for(;a>0;){let s=a/2|0,n=r+s;0>=i(e[n],t)?(r=++n,a-=s+1):a=s}return r}},7117:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=i(732);class a{constructor(){this._queue=[]}enqueue(e,t){let i={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(i);return}let a=r.default(this._queue,i,(e,t)=>t.priority-e.priority);this._queue.splice(a,0,i)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}t.default=a},7871:(e,t,i)=>{"use strict";let r=i(5099);class a extends Error{constructor(e){super(e),this.name="TimeoutError"}}let s=(e,t,i)=>new Promise((s,n)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){s(e);return}let o=setTimeout(()=>{if("function"==typeof i){try{s(i())}catch(e){n(e)}return}let r="string"==typeof i?i:`Promise timed out after ${t} milliseconds`,o=i instanceof Error?i:new a(r);"function"==typeof e.cancel&&e.cancel(),n(o)},t);r(e.then(s,n),()=>{clearTimeout(o)})});e.exports=s,e.exports.default=s,e.exports.TimeoutError=a},1804:(e,t,i)=>{let r=Symbol("SemVer ANY");class a{static get ANY(){return r}constructor(e,t){if(t=s(t),e instanceof a){if(!!t.loose===e.loose)return e;e=e.value}u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===r?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?n[o.COMPARATORLOOSE]:n[o.COMPARATOR],i=e.match(t);if(!i)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==i[1]?i[1]:"","="===this.operator&&(this.operator=""),i[2]?this.semver=new h(i[2],this.options.loose):this.semver=r}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===r||e===r)return!0;if("string"==typeof e)try{e=new h(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof a))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new c(e.value,t).test(this.value):""===e.operator?""===e.value||new c(this.value,t).test(e.semver):!((t=s(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=a;let s=i(2965),{safeRe:n,t:o}=i(824),l=i(2353),u=i(8133),h=i(6824),c=i(4378)},4378:(e,t,i)=>{let r=/\s+/g;class a{constructor(e,t){if(t=n(t),e instanceof a){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new a(e.raw,t)}if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(r," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!g(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&y(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&f)|(this.options.loose&&_))+":"+e,i=s.get(t);if(i)return i;let r=this.options.loose,a=r?h[c.HYPHENRANGELOOSE]:h[c.HYPHENRANGE];l("hyphen replace",e=e.replace(a,R(this.options.includePrerelease))),l("comparator trim",e=e.replace(h[c.COMPARATORTRIM],d)),l("tilde trim",e=e.replace(h[c.TILDETRIM],p)),l("caret trim",e=e.replace(h[c.CARETTRIM],m));let n=e.split(" ").map(e=>w(e,this.options)).join(" ").split(/\s+/).map(e=>A(e,this.options));r&&(n=n.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(h[c.COMPARATORLOOSE])))),l("range list",n);let u=new Map;for(let e of n.map(e=>new o(e,this.options))){if(g(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let y=[...u.values()];return s.set(t,y),y}intersects(e,t){if(!(e instanceof a))throw TypeError("a Range is required");return this.set.some(i=>b(i,t)&&e.set.some(e=>b(e,t)&&i.every(i=>e.every(e=>i.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(x(this.set[t],e,this.options))return!0;return!1}}e.exports=a;let s=new(i(5135)),n=i(2965),o=i(1804),l=i(8133),u=i(6824),{safeRe:h,t:c,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:m}=i(824),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:_}=i(7726),g=e=>"<0.0.0-0"===e.value,y=e=>""===e.value,b=(e,t)=>{let i=!0,r=e.slice(),a=r.pop();for(;i&&r.length;)i=r.every(e=>a.intersects(e,t)),a=r.pop();return i},w=(e,t)=>(l("comp",e,t),l("caret",e=I(e,t)),l("tildes",e=E(e,t)),l("xrange",e=$(e,t)),l("stars",e=P(e,t)),e),v=e=>!e||"x"===e.toLowerCase()||"*"===e,E=(e,t)=>e.trim().split(/\s+/).map(e=>S(e,t)).join(" "),S=(e,t)=>{let i=t.loose?h[c.TILDELOOSE]:h[c.TILDE];return e.replace(i,(t,i,r,a,s)=>{let n;return l("tilde",e,t,i,r,a,s),v(i)?n="":v(r)?n=`>=${i}.0.0 <${+i+1}.0.0-0`:v(a)?n=`>=${i}.${r}.0 <${i}.${+r+1}.0-0`:s?(l("replaceTilde pr",s),n=`>=${i}.${r}.${a}-${s} <${i}.${+r+1}.0-0`):n=`>=${i}.${r}.${a} <${i}.${+r+1}.0-0`,l("tilde return",n),n})},I=(e,t)=>e.trim().split(/\s+/).map(e=>O(e,t)).join(" "),O=(e,t)=>{l("caret",e,t);let i=t.loose?h[c.CARETLOOSE]:h[c.CARET],r=t.includePrerelease?"-0":"";return e.replace(i,(t,i,a,s,n)=>{let o;return l("caret",e,t,i,a,s,n),v(i)?o="":v(a)?o=`>=${i}.0.0${r} <${+i+1}.0.0-0`:v(s)?o="0"===i?`>=${i}.${a}.0${r} <${i}.${+a+1}.0-0`:`>=${i}.${a}.0${r} <${+i+1}.0.0-0`:n?(l("replaceCaret pr",n),o="0"===i?"0"===a?`>=${i}.${a}.${s}-${n} <${i}.${a}.${+s+1}-0`:`>=${i}.${a}.${s}-${n} <${i}.${+a+1}.0-0`:`>=${i}.${a}.${s}-${n} <${+i+1}.0.0-0`):(l("no pr"),o="0"===i?"0"===a?`>=${i}.${a}.${s}${r} <${i}.${a}.${+s+1}-0`:`>=${i}.${a}.${s}${r} <${i}.${+a+1}.0-0`:`>=${i}.${a}.${s} <${+i+1}.0.0-0`),l("caret return",o),o})},$=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>T(e,t)).join(" ")),T=(e,t)=>{e=e.trim();let i=t.loose?h[c.XRANGELOOSE]:h[c.XRANGE];return e.replace(i,(i,r,a,s,n,o)=>{l("xRange",e,i,r,a,s,n,o);let u=v(a),h=u||v(s),c=h||v(n);return"="===r&&c&&(r=""),o=t.includePrerelease?"-0":"",u?i=">"===r||"<"===r?"<0.0.0-0":"*":r&&c?(h&&(s=0),n=0,">"===r?(r=">=",h?(a=+a+1,s=0):s=+s+1,n=0):"<="===r&&(r="<",h?a=+a+1:s=+s+1),"<"===r&&(o="-0"),i=`${r+a}.${s}.${n}${o}`):h?i=`>=${a}.0.0${o} <${+a+1}.0.0-0`:c&&(i=`>=${a}.${s}.0${o} <${a}.${+s+1}.0-0`),l("xRange return",i),i})},P=(e,t)=>(l("replaceStars",e,t),e.trim().replace(h[c.STAR],"")),A=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(h[t.includePrerelease?c.GTE0PRE:c.GTE0],"")),R=e=>(t,i,r,a,s,n,o,l,u,h,c,d)=>(i=v(r)?"":v(a)?`>=${r}.0.0${e?"-0":""}`:v(s)?`>=${r}.${a}.0${e?"-0":""}`:n?`>=${i}`:`>=${i}${e?"-0":""}`,l=v(u)?"":v(h)?`<${+u+1}.0.0-0`:v(c)?`<${u}.${+h+1}.0-0`:d?`<=${u}.${h}.${c}-${d}`:e?`<${u}.${h}.${+c+1}-0`:`<=${l}`,`${i} ${l}`.trim()),x=(e,t,i)=>{for(let i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!i.includePrerelease){for(let i=0;i<e.length;i++)if(l(e[i].semver),e[i].semver!==o.ANY&&e[i].semver.prerelease.length>0){let r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}},6824:(e,t,i)=>{let r=i(8133),{MAX_LENGTH:a,MAX_SAFE_INTEGER:s}=i(7726),{safeRe:n,safeSrc:o,t:l}=i(824),u=i(2965),{compareIdentifiers:h}=i(8865);class c{constructor(e,t){if(t=u(t),e instanceof c){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>a)throw TypeError(`version is longer than ${a} characters`);r("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let i=e.trim().match(t.loose?n[l.LOOSE]:n[l.FULL]);if(!i)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>s||this.major<0)throw TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<s)return t}return e}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(r("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),h(this.major,e.major)||h(this.minor,e.minor)||h(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let i=this.prerelease[t],a=e.prerelease[t];if(r("prerelease compare",t,i,a),void 0===i&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===i)return -1;if(i===a)continue;else return h(i,a)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let i=this.build[t],a=e.build[t];if(r("build compare",t,i,a),void 0===i&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===i)return -1;if(i===a)continue;else return h(i,a)}while(++t)}inc(e,t,i){if(e.startsWith("pre")){if(!t&&!1===i)throw Error("invalid increment argument: identifier is empty");if(t){let e=RegExp(`^${this.options.loose?o[l.PRERELEASELOOSE]:o[l.PRERELEASE]}$`),i=`-${t}`.match(e);if(!i||i[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,i),this.inc("pre",t,i);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,i),this.inc("pre",t,i);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=Number(i)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===i)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===i&&(r=[t]),0===h(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=c},6914:(e,t,i)=>{let r=i(7917);e.exports=(e,t)=>{let i=r(e.trim().replace(/^[=v]+/,""),t);return i?i.version:null}},2353:(e,t,i)=>{let r=i(9649),a=i(7036),s=i(158),n=i(3709),o=i(3099),l=i(184);e.exports=(e,t,i,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e===i;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof i&&(i=i.version),e!==i;case"":case"=":case"==":return r(e,i,u);case"!=":return a(e,i,u);case">":return s(e,i,u);case">=":return n(e,i,u);case"<":return o(e,i,u);case"<=":return l(e,i,u);default:throw TypeError(`Invalid operator: ${t}`)}}},872:(e,t,i)=>{let r=i(6824),a=i(7917),{safeRe:s,t:n}=i(824);e.exports=(e,t)=>{if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let i=null;if((t=t||{}).rtl){let r;let a=t.includePrerelease?s[n.COERCERTLFULL]:s[n.COERCERTL];for(;(r=a.exec(e))&&(!i||i.index+i[0].length!==e.length);)i&&r.index+r[0].length===i.index+i[0].length||(i=r),a.lastIndex=r.index+r[1].length+r[2].length;a.lastIndex=-1}else i=e.match(t.includePrerelease?s[n.COERCEFULL]:s[n.COERCE]);if(null===i)return null;let o=i[2],l=i[3]||"0",u=i[4]||"0",h=t.includePrerelease&&i[5]?`-${i[5]}`:"",c=t.includePrerelease&&i[6]?`+${i[6]}`:"";return a(`${o}.${l}.${u}${h}${c}`,t)}},5642:(e,t,i)=>{let r=i(6824);e.exports=(e,t,i)=>{let a=new r(e,i),s=new r(t,i);return a.compare(s)||a.compareBuild(s)}},668:(e,t,i)=>{let r=i(9856);e.exports=(e,t)=>r(e,t,!0)},9856:(e,t,i)=>{let r=i(6824);e.exports=(e,t,i)=>new r(e,i).compare(new r(t,i))},2085:(e,t,i)=>{let r=i(7917);e.exports=(e,t)=>{let i=r(e,null,!0),a=r(t,null,!0),s=i.compare(a);if(0===s)return null;let n=s>0,o=n?i:a,l=n?a:i,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let h=u?"pre":"";return i.major!==a.major?h+"major":i.minor!==a.minor?h+"minor":i.patch!==a.patch?h+"patch":"prerelease"}},9649:(e,t,i)=>{let r=i(9856);e.exports=(e,t,i)=>0===r(e,t,i)},158:(e,t,i)=>{let r=i(9856);e.exports=(e,t,i)=>r(e,t,i)>0},3709:(e,t,i)=>{let r=i(9856);e.exports=(e,t,i)=>r(e,t,i)>=0},7988:(e,t,i)=>{let r=i(6824);e.exports=(e,t,i,a,s)=>{"string"==typeof i&&(s=a,a=i,i=void 0);try{return new r(e instanceof r?e.version:e,i).inc(t,a,s).version}catch(e){return null}}},3099:(e,t,i)=>{let r=i(9856);e.exports=(e,t,i)=>0>r(e,t,i)},184:(e,t,i)=>{let r=i(9856);e.exports=(e,t,i)=>0>=r(e,t,i)},4085:(e,t,i)=>{let r=i(6824);e.exports=(e,t)=>new r(e,t).major},4854:(e,t,i)=>{let r=i(6824);e.exports=(e,t)=>new r(e,t).minor},7036:(e,t,i)=>{let r=i(9856);e.exports=(e,t,i)=>0!==r(e,t,i)},7917:(e,t,i)=>{let r=i(6824);e.exports=(e,t,i=!1)=>{if(e instanceof r)return e;try{return new r(e,t)}catch(e){if(!i)return null;throw e}}},8092:(e,t,i)=>{let r=i(6824);e.exports=(e,t)=>new r(e,t).patch},1492:(e,t,i)=>{let r=i(7917);e.exports=(e,t)=>{let i=r(e,t);return i&&i.prerelease.length?i.prerelease:null}},2045:(e,t,i)=>{let r=i(9856);e.exports=(e,t,i)=>r(t,e,i)},5360:(e,t,i)=>{let r=i(5642);e.exports=(e,t)=>e.sort((e,i)=>r(i,e,t))},3118:(e,t,i)=>{let r=i(4378);e.exports=(e,t,i)=>{try{t=new r(t,i)}catch(e){return!1}return t.test(e)}},9282:(e,t,i)=>{let r=i(5642);e.exports=(e,t)=>e.sort((e,i)=>r(e,i,t))},9719:(e,t,i)=>{let r=i(7917);e.exports=(e,t)=>{let i=r(e,t);return i?i.version:null}},1998:(e,t,i)=>{let r=i(824),a=i(7726),s=i(6824),n=i(8865),o=i(7917),l=i(9719),u=i(6914),h=i(7988),c=i(2085),d=i(4085),p=i(4854),m=i(8092),f=i(1492),_=i(9856),g=i(2045),y=i(668),b=i(5642),w=i(9282),v=i(5360),E=i(158),S=i(3099),I=i(9649),O=i(7036),$=i(3709),T=i(184),P=i(2353),A=i(872),R=i(1804),x=i(4378),N=i(3118),j=i(7455),C=i(4569),L=i(580),U=i(1925),k=i(6089),D=i(2473),M=i(1712),F=i(1125),z=i(3795),B=i(1957),G=i(7709);e.exports={parse:o,valid:l,clean:u,inc:h,diff:c,major:d,minor:p,patch:m,prerelease:f,compare:_,rcompare:g,compareLoose:y,compareBuild:b,sort:w,rsort:v,gt:E,lt:S,eq:I,neq:O,gte:$,lte:T,cmp:P,coerce:A,Comparator:R,Range:x,satisfies:N,toComparators:j,maxSatisfying:C,minSatisfying:L,minVersion:U,validRange:k,outside:D,gtr:M,ltr:F,intersects:z,simplifyRange:B,subset:G,SemVer:s,re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:a.SEMVER_SPEC_VERSION,RELEASE_TYPES:a.RELEASE_TYPES,compareIdentifiers:n.compareIdentifiers,rcompareIdentifiers:n.rcompareIdentifiers}},7726:e=>{let t=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},8133:e=>{let t="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},8865:e=>{let t=/^[0-9]+$/,i=(e,i)=>{let r=t.test(e),a=t.test(i);return r&&a&&(e=+e,i=+i),e===i?0:r&&!a?-1:a&&!r?1:e<i?-1:1};e.exports={compareIdentifiers:i,rcompareIdentifiers:(e,t)=>i(t,e)}},5135:e=>{class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},2965:e=>{let t=Object.freeze({loose:!0}),i=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:i},824:(e,t,i)=>{let{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:a,MAX_LENGTH:s}=i(7726),n=i(8133),o=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],h=t.safeSrc=[],c=t.t={},d=0,p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",s],[p,a]],f=e=>{for(let[t,i]of m)e=e.split(`${t}*`).join(`${t}{0,${i}}`).split(`${t}+`).join(`${t}{1,${i}}`);return e},_=(e,t,i)=>{let r=f(t),a=d++;n(e,a,t),c[e]=a,u[a]=t,h[a]=r,o[a]=new RegExp(t,i?"g":void 0),l[a]=new RegExp(r,i?"g":void 0)};_("NUMERICIDENTIFIER","0|[1-9]\\d*"),_("NUMERICIDENTIFIERLOOSE","\\d+"),_("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),_("MAINVERSION",`(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})\\.(${u[c.NUMERICIDENTIFIER]})`),_("MAINVERSIONLOOSE",`(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})\\.(${u[c.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASEIDENTIFIER",`(?:${u[c.NUMERICIDENTIFIER]}|${u[c.NONNUMERICIDENTIFIER]})`),_("PRERELEASEIDENTIFIERLOOSE",`(?:${u[c.NUMERICIDENTIFIERLOOSE]}|${u[c.NONNUMERICIDENTIFIER]})`),_("PRERELEASE",`(?:-(${u[c.PRERELEASEIDENTIFIER]}(?:\\.${u[c.PRERELEASEIDENTIFIER]})*))`),_("PRERELEASELOOSE",`(?:-?(${u[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[c.PRERELEASEIDENTIFIERLOOSE]})*))`),_("BUILDIDENTIFIER",`${p}+`),_("BUILD",`(?:\\+(${u[c.BUILDIDENTIFIER]}(?:\\.${u[c.BUILDIDENTIFIER]})*))`),_("FULLPLAIN",`v?${u[c.MAINVERSION]}${u[c.PRERELEASE]}?${u[c.BUILD]}?`),_("FULL",`^${u[c.FULLPLAIN]}$`),_("LOOSEPLAIN",`[v=\\s]*${u[c.MAINVERSIONLOOSE]}${u[c.PRERELEASELOOSE]}?${u[c.BUILD]}?`),_("LOOSE",`^${u[c.LOOSEPLAIN]}$`),_("GTLT","((?:<|>)?=?)"),_("XRANGEIDENTIFIERLOOSE",`${u[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),_("XRANGEIDENTIFIER",`${u[c.NUMERICIDENTIFIER]}|x|X|\\*`),_("XRANGEPLAIN",`[v=\\s]*(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:\\.(${u[c.XRANGEIDENTIFIER]})(?:${u[c.PRERELEASE]})?${u[c.BUILD]}?)?)?`),_("XRANGEPLAINLOOSE",`[v=\\s]*(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[c.XRANGEIDENTIFIERLOOSE]})(?:${u[c.PRERELEASELOOSE]})?${u[c.BUILD]}?)?)?`),_("XRANGE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAIN]}$`),_("XRANGELOOSE",`^${u[c.GTLT]}\\s*${u[c.XRANGEPLAINLOOSE]}$`),_("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),_("COERCE",`${u[c.COERCEPLAIN]}(?:$|[^\\d])`),_("COERCEFULL",u[c.COERCEPLAIN]+`(?:${u[c.PRERELEASE]})?`+`(?:${u[c.BUILD]})?`+"(?:$|[^\\d])"),_("COERCERTL",u[c.COERCE],!0),_("COERCERTLFULL",u[c.COERCEFULL],!0),_("LONETILDE","(?:~>?)"),_("TILDETRIM",`(\\s*)${u[c.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",_("TILDE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAIN]}$`),_("TILDELOOSE",`^${u[c.LONETILDE]}${u[c.XRANGEPLAINLOOSE]}$`),_("LONECARET","(?:\\^)"),_("CARETTRIM",`(\\s*)${u[c.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",_("CARET",`^${u[c.LONECARET]}${u[c.XRANGEPLAIN]}$`),_("CARETLOOSE",`^${u[c.LONECARET]}${u[c.XRANGEPLAINLOOSE]}$`),_("COMPARATORLOOSE",`^${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]})$|^$`),_("COMPARATOR",`^${u[c.GTLT]}\\s*(${u[c.FULLPLAIN]})$|^$`),_("COMPARATORTRIM",`(\\s*)${u[c.GTLT]}\\s*(${u[c.LOOSEPLAIN]}|${u[c.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",_("HYPHENRANGE",`^\\s*(${u[c.XRANGEPLAIN]})\\s+-\\s+(${u[c.XRANGEPLAIN]})\\s*$`),_("HYPHENRANGELOOSE",`^\\s*(${u[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[c.XRANGEPLAINLOOSE]})\\s*$`),_("STAR","(<|>)?=?\\s*\\*"),_("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),_("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},1712:(e,t,i)=>{let r=i(2473);e.exports=(e,t,i)=>r(e,t,">",i)},3795:(e,t,i)=>{let r=i(4378);e.exports=(e,t,i)=>(e=new r(e,i),t=new r(t,i),e.intersects(t,i))},1125:(e,t,i)=>{let r=i(2473);e.exports=(e,t,i)=>r(e,t,"<",i)},4569:(e,t,i)=>{let r=i(6824),a=i(4378);e.exports=(e,t,i)=>{let s=null,n=null,o=null;try{o=new a(t,i)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!s||-1===n.compare(e))&&(n=new r(s=e,i))}),s}},580:(e,t,i)=>{let r=i(6824),a=i(4378);e.exports=(e,t,i)=>{let s=null,n=null,o=null;try{o=new a(t,i)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!s||1===n.compare(e))&&(n=new r(s=e,i))}),s}},1925:(e,t,i)=>{let r=i(6824),a=i(4378),s=i(158);e.exports=(e,t)=>{e=new a(e,t);let i=new r("0.0.0");if(e.test(i)||(i=new r("0.0.0-0"),e.test(i)))return i;i=null;for(let t=0;t<e.set.length;++t){let a=e.set[t],n=null;a.forEach(e=>{let t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!n||s(t,n))&&(n=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),n&&(!i||s(i,n))&&(i=n)}return i&&e.test(i)?i:null}},2473:(e,t,i)=>{let r=i(6824),a=i(1804),{ANY:s}=a,n=i(4378),o=i(3118),l=i(158),u=i(3099),h=i(184),c=i(3709);e.exports=(e,t,i,d)=>{let p,m,f,_,g;switch(e=new r(e,d),t=new n(t,d),i){case">":p=l,m=h,f=u,_=">",g=">=";break;case"<":p=u,m=c,f=l,_="<",g="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,d))return!1;for(let i=0;i<t.set.length;++i){let r=t.set[i],n=null,o=null;if(r.forEach(e=>{e.semver===s&&(e=new a(">=0.0.0")),n=n||e,o=o||e,p(e.semver,n.semver,d)?n=e:f(e.semver,o.semver,d)&&(o=e)}),n.operator===_||n.operator===g||(!o.operator||o.operator===_)&&m(e,o.semver)||o.operator===g&&f(e,o.semver))return!1}return!0}},1957:(e,t,i)=>{let r=i(3118),a=i(9856);e.exports=(e,t,i)=>{let s=[],n=null,o=null,l=e.sort((e,t)=>a(e,t,i));for(let e of l)r(e,t,i)?(o=e,n||(n=e)):(o&&s.push([n,o]),o=null,n=null);n&&s.push([n,null]);let u=[];for(let[e,t]of s)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let h=u.join(" || "),c="string"==typeof t.raw?t.raw:String(t);return h.length<c.length?h:t}},7709:(e,t,i)=>{let r=i(4378),a=i(1804),{ANY:s}=a,n=i(3118),o=i(9856),l=[new a(">=0.0.0-0")],u=[new a(">=0.0.0")],h=(e,t,i)=>{let r,a,h,p,m,f,_;if(e===t)return!0;if(1===e.length&&e[0].semver===s){if(1===t.length&&t[0].semver===s)return!0;e=i.includePrerelease?l:u}if(1===t.length&&t[0].semver===s){if(i.includePrerelease)return!0;t=u}let g=new Set;for(let t of e)">"===t.operator||">="===t.operator?r=c(r,t,i):"<"===t.operator||"<="===t.operator?a=d(a,t,i):g.add(t.semver);if(g.size>1||r&&a&&((h=o(r.semver,a.semver,i))>0||0===h&&(">="!==r.operator||"<="!==a.operator)))return null;for(let e of g){if(r&&!n(e,String(r),i)||a&&!n(e,String(a),i))return null;for(let r of t)if(!n(e,String(r),i))return!1;return!0}let y=!!a&&!i.includePrerelease&&!!a.semver.prerelease.length&&a.semver,b=!!r&&!i.includePrerelease&&!!r.semver.prerelease.length&&r.semver;for(let e of(y&&1===y.prerelease.length&&"<"===a.operator&&0===y.prerelease[0]&&(y=!1),t)){if(_=_||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,r){if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),">"===e.operator||">="===e.operator){if((p=c(r,e,i))===e&&p!==r)return!1}else if(">="===r.operator&&!n(r.semver,String(e),i))return!1}if(a){if(y&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch&&(y=!1),"<"===e.operator||"<="===e.operator){if((m=d(a,e,i))===e&&m!==a)return!1}else if("<="===a.operator&&!n(a.semver,String(e),i))return!1}if(!e.operator&&(a||r)&&0!==h)return!1}return(!r||!f||!!a||0===h)&&(!a||!_||!!r||0===h)&&!b&&!y},c=(e,t,i)=>{if(!e)return t;let r=o(e.semver,t.semver,i);return r>0?e:r<0?t:">"===t.operator&&">="===e.operator?t:e},d=(e,t,i)=>{if(!e)return t;let r=o(e.semver,t.semver,i);return r<0?e:r>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,i={})=>{if(e===t)return!0;e=new r(e,i),t=new r(t,i);let a=!1;e:for(let r of e.set){for(let e of t.set){let t=h(r,e,i);if(a=a||null!==t,t)continue e}if(a)return!1}return!0}},7455:(e,t,i)=>{let r=i(4378);e.exports=(e,t)=>new r(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},6089:(e,t,i)=>{let r=i(4378);e.exports=(e,t)=>{try{return new r(e,t).range||"*"}catch(e){return null}}},1506:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a});var r=i(9510);function a({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{children:e})})}},908:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});let r=(0,i(8570).createProxy)(String.raw`/Users/mukil/langchain/langsmith-sdk/js/internal/environment_tests/test-exports-nextjs/app/page.tsx#default`)}};var t=require("../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[819],()=>i(1584));module.exports=r})();